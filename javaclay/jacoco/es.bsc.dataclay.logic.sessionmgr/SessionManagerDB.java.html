<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SessionManagerDB.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">dataclay</a> &gt; <a href="index.source.html" class="el_package">es.bsc.dataclay.logic.sessionmgr</a> &gt; <span class="el_source">SessionManagerDB.java</span></div><h1>SessionManagerDB.java</h1><pre class="source lang-java linenums">
package es.bsc.dataclay.logic.sessionmgr;

import java.sql.Array;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.UUID;

import org.apache.commons.dbcp2.BasicDataSource;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import es.bsc.dataclay.communication.grpc.messages.common.CommonMessages.Langs;
import es.bsc.dataclay.dbhandler.Utils;
import es.bsc.dataclay.exceptions.dbhandler.DbObjectAlreadyExistException;
import es.bsc.dataclay.util.Configuration;
import es.bsc.dataclay.util.ids.AccountID;
import es.bsc.dataclay.util.ids.ContractID;
import es.bsc.dataclay.util.ids.DataClayInstanceID;
import es.bsc.dataclay.util.ids.DataContractID;
import es.bsc.dataclay.util.ids.DataSetID;
import es.bsc.dataclay.util.ids.ImplementationID;
import es.bsc.dataclay.util.ids.InterfaceID;
import es.bsc.dataclay.util.ids.MetaClassID;
import es.bsc.dataclay.util.ids.NamespaceID;
import es.bsc.dataclay.util.ids.OperationID;
import es.bsc.dataclay.util.ids.PropertyID;
import es.bsc.dataclay.util.ids.SessionID;
import es.bsc.dataclay.util.management.sessionmgr.SessionContract;
import es.bsc.dataclay.util.management.sessionmgr.SessionDataContract;
import es.bsc.dataclay.util.management.sessionmgr.SessionImplementation;
import es.bsc.dataclay.util.management.sessionmgr.SessionInterface;
import es.bsc.dataclay.util.management.sessionmgr.SessionOperation;
import es.bsc.dataclay.util.management.sessionmgr.SessionProperty;

/**
 * Data base connection.
 */
public final class SessionManagerDB {

	/** Data source. */
	private final BasicDataSource dataSource;

	/** Logger. */
	private Logger logger;

	/** Indicates if debug is enabled. */
<span class="fc" id="L58">	private static final boolean DEBUG_ENABLED = Configuration.isDebugEnabled();</span>

	/**
	 * Constructor.
	 * 
	 * @param managerName
	 *            Name of the LM service managing.
	 */
<span class="fc" id="L66">	public SessionManagerDB(final BasicDataSource dataSource) {</span>
<span class="fc" id="L67">		this.dataSource = dataSource;</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">		if (DEBUG_ENABLED) {</span>
<span class="nc" id="L69">			logger = LogManager.getLogger(&quot;LMDB&quot;);</span>
		}
<span class="fc" id="L71">	}</span>

	/**
	 * Create tables of MDS.
	 */
	public void createTables() {

<span class="fc" id="L78">		Connection conn = null;</span>
		try {
<span class="fc" id="L80">			conn = dataSource.getConnection();</span>
<span class="fc bfc" id="L81" title="All 2 branches covered.">			for (final SessionManagerSQLStatements.SqlStatements stmt : SessionManagerSQLStatements.SqlStatements.values()) {</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">				if (stmt.name().startsWith(&quot;CREATE_TABLE&quot;)) {</span>
<span class="fc" id="L83">					final PreparedStatement updateStatement = conn.prepareStatement(stmt.getSqlStatement());</span>
<span class="fc" id="L84">					updateStatement.execute();</span>
				}
			}
<span class="nc" id="L87">		} catch (final SQLException e) {</span>
<span class="nc" id="L88">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L92">					conn.close();</span>
				}
<span class="nc" id="L94">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L95">				ex1.printStackTrace();</span>
<span class="fc" id="L96">			}</span>
		}
<span class="fc" id="L98">	}</span>

	/**
	 * Delete the tables of MDS. Just the other way around of createTables --much simpler.
	 */
	public void dropTables() {

<span class="fc" id="L105">		Connection conn = null;</span>
		try {
<span class="fc" id="L107">			conn = dataSource.getConnection();</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">			for (final SessionManagerSQLStatements.SqlStatements stmt : SessionManagerSQLStatements.SqlStatements.values()) {</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">				if (stmt.name().startsWith(&quot;DROP_TABLE&quot;)) {</span>
<span class="fc" id="L110">					final PreparedStatement updateStatement = conn.prepareStatement(stmt.getSqlStatement());</span>
<span class="fc" id="L111">					updateStatement.execute();</span>
				}
			}
<span class="nc" id="L114">		} catch (final SQLException e) {</span>
<span class="nc" id="L115">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L119">					conn.close();</span>
				}
<span class="nc" id="L121">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L122">				ex1.printStackTrace();</span>
<span class="fc" id="L123">			}</span>
		}
<span class="fc" id="L125">	}</span>

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionInterface infoSession) {

<span class="fc" id="L135">		UUID[] sessPropsUUIDs = null;</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">		if (infoSession.getSessionProperties() != null) {</span>
<span class="nc" id="L137">			sessPropsUUIDs = new UUID[infoSession.getSessionProperties().size()];</span>
<span class="nc" id="L138">			int i = 0;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">			for (final SessionProperty sessProp : infoSession.getSessionProperties().values()) {</span>
<span class="nc" id="L140">				sessPropsUUIDs[i] = this.store(sessProp);</span>
<span class="nc" id="L141">				i++;</span>
<span class="nc" id="L142">			}</span>
		}

<span class="fc" id="L145">		UUID[] sessOpsUUIDs = null;</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">		if (infoSession.getSessionOperations() != null) {</span>
<span class="fc" id="L147">			sessOpsUUIDs = new UUID[infoSession.getSessionOperations().size()];</span>
<span class="fc" id="L148">			int i = 0;</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">			for (final SessionOperation sessOp : infoSession.getSessionOperations().values()) {</span>
<span class="fc" id="L150">				sessOpsUUIDs[i] = this.store(sessOp);</span>
<span class="fc" id="L151">				i++;</span>
<span class="fc" id="L152">			}</span>
		}

<span class="fc" id="L155">		Connection conn = null;</span>
<span class="fc" id="L156">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L157">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L159">			conn = dataSource.getConnection();</span>
<span class="fc" id="L160">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONINTERFACE.getSqlStatement());</span>
<span class="fc" id="L161">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF

<span class="fc" id="L164">			insertStatement.setObject(2, infoSession.getInterfaceID().getId());</span>
<span class="pc bpc" id="L165" title="1 of 2 branches missed.">			if (sessPropsUUIDs != null) {</span>
<span class="nc" id="L166">				final Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessPropsUUIDs);</span>
<span class="nc" id="L167">				insertStatement.setArray(3, tArray);</span>
<span class="nc" id="L168">			} else {</span>
<span class="fc" id="L169">				insertStatement.setArray(3, null);</span>
			}

<span class="pc bpc" id="L172" title="1 of 2 branches missed.">			if (sessOpsUUIDs != null) {</span>
<span class="fc" id="L173">				final Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessOpsUUIDs);</span>
<span class="fc" id="L174">				insertStatement.setArray(4, tArray);</span>
<span class="fc" id="L175">			} else {</span>
<span class="nc" id="L176">				insertStatement.setArray(4, null);</span>
			}

<span class="fc" id="L179">			insertStatement.setObject(5, infoSession.getClassOfInterface().getId());</span>

<span class="pc bpc" id="L181" title="1 of 2 branches missed.">			if (infoSession.getImportOfInterface() != null) {</span>
<span class="nc" id="L182">				insertStatement.setObject(6, infoSession.getImportOfInterface().getId());</span>
			} else {
<span class="fc" id="L184">				insertStatement.setObject(6, null);</span>
			}

			// CHECKSTYLE:ON
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L189">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L191">			insertStatement.executeUpdate();</span>

<span class="nc" id="L193">		} catch (final Exception e) {</span>
<span class="nc" id="L194">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L198">					conn.close();</span>
				}
<span class="nc" id="L200">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L201">				ex1.printStackTrace();</span>
<span class="fc" id="L202">			}</span>
		}
<span class="fc" id="L204">		return uuid;</span>
	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionContract infoSession) {

<span class="fc" id="L215">		final UUID[] sessInterfaceIDs = new UUID[infoSession.getSessionInterfaces().size()];</span>
<span class="fc" id="L216">		int i = 0;</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">		for (final SessionInterface sessionIface : infoSession.getSessionInterfaces().values()) {</span>
<span class="fc" id="L218">			sessInterfaceIDs[i] = this.store(sessionIface);</span>
<span class="fc" id="L219">			i++;</span>
<span class="fc" id="L220">		}</span>

<span class="fc" id="L222">		Connection conn = null;</span>
<span class="fc" id="L223">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L224">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L226">			conn = dataSource.getConnection();</span>
<span class="fc" id="L227">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONCONTRACT.getSqlStatement());</span>
<span class="fc" id="L228">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF
<span class="fc" id="L230">			insertStatement.setObject(2, infoSession.getContractID().getId());</span>

<span class="fc" id="L232">			final Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessInterfaceIDs);</span>
<span class="fc" id="L233">			insertStatement.setArray(3, tArray);</span>

			// CHECKSTYLE:ON
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L237">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L239">			insertStatement.executeUpdate();</span>

<span class="nc" id="L241">		} catch (final Exception e) {</span>
<span class="nc" id="L242">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L245" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L246">					conn.close();</span>
				}
<span class="nc" id="L248">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L249">				ex1.printStackTrace();</span>
<span class="fc" id="L250">			}</span>
		}
<span class="fc" id="L252">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionProperty infoSession) {
<span class="nc" id="L263">		Connection conn = null;</span>
<span class="nc" id="L264">		final UUID uuid = UUID.randomUUID();</span>
<span class="nc" id="L265">		infoSession.setId(uuid);</span>
		try {
<span class="nc" id="L267">			conn = dataSource.getConnection();</span>
<span class="nc" id="L268">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONPROPERTY.getSqlStatement());</span>
<span class="nc" id="L269">			insertStatement.setObject(1, uuid);</span>
<span class="nc" id="L270">			insertStatement.setObject(2, infoSession.getPropertyID().getId());</span>
			// CHECKSTYLE:OFF
			// CHECKSTYLE:ON
<span class="nc bnc" id="L273" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L274">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="nc" id="L276">			insertStatement.executeUpdate();</span>

<span class="nc" id="L278">		} catch (final Exception e) {</span>
<span class="nc" id="L279">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L282" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L283">					conn.close();</span>
				}
<span class="nc" id="L285">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L286">				ex1.printStackTrace();</span>
<span class="nc" id="L287">			}</span>
		}
<span class="nc" id="L289">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionImplementation infoSession) {
<span class="nc" id="L300">		Connection conn = null;</span>
<span class="nc" id="L301">		final UUID uuid = UUID.randomUUID();</span>
<span class="nc" id="L302">		infoSession.setId(uuid);</span>
		try {
<span class="nc" id="L304">			conn = dataSource.getConnection();</span>
<span class="nc" id="L305">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONIMPLEMENTATION.getSqlStatement());</span>
<span class="nc" id="L306">			insertStatement.setObject(1, uuid);</span>
<span class="nc" id="L307">			insertStatement.setObject(2, infoSession.getImplementationID().getId());</span>
			// CHECKSTYLE:OFF
<span class="nc" id="L309">			insertStatement.setObject(3, infoSession.getNamespaceID().getId());</span>
<span class="nc" id="L310">			insertStatement.setObject(4, infoSession.getRespAccountID().getId());</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L312" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L313">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="nc" id="L315">			insertStatement.executeUpdate();</span>

<span class="nc" id="L317">		} catch (final Exception e) {</span>
<span class="nc" id="L318">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L321" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L322">					conn.close();</span>
				}
<span class="nc" id="L324">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L325">				ex1.printStackTrace();</span>
<span class="nc" id="L326">			}</span>
		}
<span class="nc" id="L328">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionOperation infoSession) {

<span class="fc" id="L340">		UUID localImplUUID = null;</span>
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">		if (infoSession.getSessionLocalImplementation() != null) {</span>
<span class="nc" id="L342">			localImplUUID = this.store(infoSession.getSessionLocalImplementation());</span>
		}

<span class="fc" id="L345">		UUID remoteImplUUID = null;</span>
<span class="pc bpc" id="L346" title="1 of 2 branches missed.">		if (infoSession.getSessionRemoteImplementation() != null) {</span>
<span class="nc" id="L347">			remoteImplUUID = this.store(infoSession.getSessionRemoteImplementation());</span>
		}

<span class="fc" id="L350">		Connection conn = null;</span>
<span class="fc" id="L351">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L352">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L354">			conn = dataSource.getConnection();</span>
<span class="fc" id="L355">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONOPERATION.getSqlStatement());</span>
<span class="fc" id="L356">			insertStatement.setObject(1, uuid);</span>
<span class="fc" id="L357">			insertStatement.setObject(2, infoSession.getOperationID().getId());</span>
			// CHECKSTYLE:OFF

<span class="fc" id="L360">			insertStatement.setObject(3, localImplUUID);</span>
<span class="fc" id="L361">			insertStatement.setObject(4, remoteImplUUID);</span>

			// CHECKSTYLE:ON
<span class="pc bpc" id="L364" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L365">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L367">			insertStatement.executeUpdate();</span>

<span class="nc" id="L369">		} catch (final Exception e) {</span>
<span class="nc" id="L370">			e.printStackTrace();</span>
<span class="nc" id="L371">			throw new DbObjectAlreadyExistException(infoSession.getOperationID());</span>
		} finally {
			try {
<span class="pc bpc" id="L374" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L375">					conn.close();</span>
				}
<span class="nc" id="L377">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L378">				ex1.printStackTrace();</span>
<span class="fc" id="L379">			}</span>
		}
<span class="fc" id="L381">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionDataContract infoSession) {
<span class="fc" id="L392">		Connection conn = null;</span>
<span class="fc" id="L393">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L394">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L396">			conn = dataSource.getConnection();</span>
<span class="fc" id="L397">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONDATACONTRACT.getSqlStatement());</span>
<span class="fc" id="L398">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF
<span class="fc" id="L400">			insertStatement.setObject(2, infoSession.getDataContractID().getId());</span>
<span class="fc" id="L401">			insertStatement.setObject(3, infoSession.getDataSetOfProvider().getId());</span>
			// CHECKSTYLE:ON
<span class="pc bpc" id="L403" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L404">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L406">			insertStatement.executeUpdate();</span>

<span class="nc" id="L408">		} catch (final Exception e) {</span>
<span class="nc" id="L409">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L412" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L413">					conn.close();</span>
				}
<span class="nc" id="L415">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L416">				ex1.printStackTrace();</span>
<span class="fc" id="L417">			}</span>
		}
<span class="fc" id="L419">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 */
	public void store(final Session infoSession) {

<span class="fc" id="L430">		final List&lt;UUID&gt; propKeysList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L431">		final List&lt;UUID&gt; propValuesList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L432">		int i = 0;</span>
<span class="fc bfc" id="L433" title="All 2 branches covered.">		for (final Entry&lt;MetaClassID, Set&lt;PropertyID&gt;&gt; entry : infoSession.getPropertiesOfClasses().entrySet()) {</span>
<span class="fc" id="L434">			final MetaClassID classID = entry.getKey();</span>
<span class="pc bpc" id="L435" title="1 of 2 branches missed.">			for (final PropertyID propID : entry.getValue()) {</span>
<span class="nc" id="L436">				propKeysList.add(classID.getId());</span>
<span class="nc" id="L437">				propValuesList.add(propID.getId());</span>
<span class="nc" id="L438">				i++;</span>
<span class="nc" id="L439">			}</span>
<span class="fc" id="L440">		}</span>

<span class="fc" id="L442">		final UUID[] propKeys = propKeysList.toArray(new UUID[propKeysList.size()]);</span>
<span class="fc" id="L443">		final UUID[] propValues = propValuesList.toArray(new UUID[propValuesList.size()]);</span>
<span class="fc" id="L444">		final UUID[] sessContractKeys = new UUID[infoSession.getSessionContracts().size()];</span>
<span class="fc" id="L445">		final UUID[] sessContractValues = new UUID[infoSession.getSessionContracts().size()];</span>
<span class="fc" id="L446">		i = 0;</span>
<span class="fc bfc" id="L447" title="All 2 branches covered.">		for (final Entry&lt;ContractID, SessionContract&gt; entry : infoSession.getSessionContracts().entrySet()) {</span>
<span class="fc" id="L448">			sessContractKeys[i] = entry.getKey().getId();</span>
<span class="fc" id="L449">			sessContractValues[i] = this.store(entry.getValue());</span>
<span class="fc" id="L450">			i++;</span>
<span class="fc" id="L451">		}</span>

<span class="fc" id="L453">		final UUID[] sessDataContractKeys = new UUID[infoSession.getSessionDataContracts().size()];</span>
<span class="fc" id="L454">		final UUID[] sessDataContractValues = new UUID[infoSession.getSessionDataContracts().size()];</span>
<span class="fc" id="L455">		i = 0;</span>
<span class="fc bfc" id="L456" title="All 2 branches covered.">		for (final Entry&lt;DataContractID, SessionDataContract&gt; entry : infoSession.getSessionDataContracts().entrySet()) {</span>
<span class="fc" id="L457">			sessDataContractKeys[i] = entry.getKey().getId();</span>
<span class="fc" id="L458">			sessDataContractValues[i] = this.store(entry.getValue());</span>
<span class="fc" id="L459">			i++;</span>
<span class="fc" id="L460">		}</span>

<span class="fc" id="L462">		final UUID[] ifaceBitmapsKeys = new UUID[infoSession.getIfaceBitmaps().size()];</span>
<span class="fc" id="L463">		final String[] ifaceBitmapsValues = new String[infoSession.getIfaceBitmaps().size()];</span>
<span class="fc" id="L464">		i = 0;</span>
<span class="pc bpc" id="L465" title="1 of 2 branches missed.">		for (final Entry&lt;MetaClassID, byte[]&gt; entry : infoSession.getIfaceBitmaps().entrySet()) {</span>
<span class="nc" id="L466">			ifaceBitmapsKeys[i] = entry.getKey().getId();</span>
<span class="nc" id="L467">			ifaceBitmapsValues[i] = Utils.bytesToHex(entry.getValue());</span>
<span class="nc" id="L468">			i++;</span>
<span class="nc" id="L469">		}</span>

<span class="fc" id="L471">		Connection conn = null;</span>
		try {
<span class="fc" id="L473">			conn = dataSource.getConnection();</span>
<span class="fc" id="L474">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONINFO.getSqlStatement());</span>
<span class="fc" id="L475">			insertStatement.setObject(1, infoSession.getDataClayID().getId());</span>

			// CHECKSTYLE:OFF
<span class="fc" id="L478">			insertStatement.setObject(2, infoSession.getAccountID().getId());</span>
<span class="fc" id="L479">			Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, propKeys);</span>
<span class="fc" id="L480">			insertStatement.setArray(3, tArray);</span>
<span class="fc" id="L481">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, propValues);</span>
<span class="fc" id="L482">			insertStatement.setArray(4, tArray);</span>
<span class="fc" id="L483">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessContractKeys);</span>
<span class="fc" id="L484">			insertStatement.setArray(5, tArray);</span>
<span class="fc" id="L485">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessContractValues);</span>
<span class="fc" id="L486">			insertStatement.setArray(6, tArray);</span>
<span class="fc" id="L487">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessDataContractKeys);</span>
<span class="fc" id="L488">			insertStatement.setArray(7, tArray);</span>
<span class="fc" id="L489">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessDataContractValues);</span>
<span class="fc" id="L490">			insertStatement.setArray(8, tArray);</span>

<span class="fc" id="L492">			insertStatement.setObject(9, infoSession.getDataContractIDofStore().getId());</span>
<span class="fc" id="L493">			insertStatement.setString(10, infoSession.getLanguage().name());</span>

<span class="fc" id="L495">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, ifaceBitmapsKeys);</span>
<span class="fc" id="L496">			insertStatement.setArray(11, tArray);</span>

<span class="fc" id="L498">			tArray = insertStatement.getConnection().createArrayOf(&quot;varchar&quot;, ifaceBitmapsValues);</span>
<span class="fc" id="L499">			insertStatement.setArray(12, tArray);</span>

<span class="fc" id="L501">			insertStatement.setDate(13, new java.sql.Date(infoSession.getEndDate().getTimeInMillis()));</span>

			// CHECKSTYLE:ON
<span class="pc bpc" id="L504" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L505">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L507">			insertStatement.executeUpdate();</span>

<span class="nc" id="L509">		} catch (final Exception e) {</span>
<span class="nc" id="L510">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L513" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L514">					conn.close();</span>
				}
<span class="nc" id="L516">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L517">				ex1.printStackTrace();</span>
<span class="fc" id="L518">			}</span>
		}

<span class="fc" id="L521">	}</span>

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionProperty
	 */
	private SessionProperty deserializeSessionProperty(
			final ResultSet rs) {
<span class="nc" id="L531">		SessionProperty session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="nc" id="L534">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="nc" id="L535">			final PropertyID propertyID = new PropertyID((UUID)rs.getObject(&quot;propertyID&quot;));</span>

<span class="nc" id="L537">			session = new SessionProperty();</span>
<span class="nc" id="L538">			session.setId(uuid);</span>
<span class="nc" id="L539">			session.setPropertyID(propertyID);</span>

<span class="nc" id="L541">		} catch (final SQLException e) {</span>
<span class="nc" id="L542">			e.printStackTrace();</span>
<span class="nc" id="L543">		}</span>
<span class="nc" id="L544">		return session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionImplementation
	 */
	private SessionImplementation deserializeSessionImplementation(
			final ResultSet rs) {
<span class="nc" id="L555">		SessionImplementation Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="nc" id="L558">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="nc" id="L559">			final ImplementationID implementationID = new ImplementationID((UUID)rs.getObject(&quot;implementationID&quot;));</span>
<span class="nc" id="L560">			final AccountID respAccountID = new AccountID((UUID)rs.getObject(&quot;respAccountID&quot;));</span>
<span class="nc" id="L561">			final NamespaceID namespaceID = new NamespaceID((UUID)rs.getObject(&quot;namespaceID&quot;));</span>

<span class="nc" id="L563">			Session = new SessionImplementation();</span>
<span class="nc" id="L564">			Session.setId(uuid);</span>
<span class="nc" id="L565">			Session.setRespAccountID(respAccountID);</span>
<span class="nc" id="L566">			Session.setNamespaceID(namespaceID);</span>
<span class="nc" id="L567">			Session.setImplementationID(implementationID);</span>

<span class="nc" id="L569">		} catch (final SQLException e) {</span>
<span class="nc" id="L570">			e.printStackTrace();</span>
<span class="nc" id="L571">		}</span>
<span class="nc" id="L572">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionOperation
	 */
	private SessionOperation deserializeSessionOperation(
			final ResultSet rs) {
<span class="fc" id="L583">		SessionOperation Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L586">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L587">			final OperationID operationID = new OperationID((UUID)rs.getObject(&quot;operationID&quot;));</span>
<span class="fc" id="L588">			final SessionImplementation sessionLocalImplementation = this.getSessionImplementationByID((UUID)rs.getObject(&quot;sessionLocalImplementation&quot;));</span>
<span class="fc" id="L589">			final SessionImplementation sessionRemoteImplementation = this.getSessionImplementationByID((UUID)rs.getObject(&quot;sessionRemoteImplementation&quot;));</span>

<span class="fc" id="L591">			Session = new SessionOperation();</span>
<span class="fc" id="L592">			Session.setId(uuid);</span>
<span class="fc" id="L593">			Session.setOperationID(operationID);</span>
<span class="fc" id="L594">			Session.setSessionLocalImplementation(sessionLocalImplementation);</span>
<span class="fc" id="L595">			Session.setSessionRemoteImplementation(sessionRemoteImplementation);</span>

<span class="nc" id="L597">		} catch (final SQLException e) {</span>
<span class="nc" id="L598">			e.printStackTrace();</span>
<span class="fc" id="L599">		}</span>
<span class="fc" id="L600">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionContract
	 */
	private SessionContract deserializeSessionContract(
			final ResultSet rs) {
<span class="fc" id="L611">		SessionContract Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L614">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L615">			final ContractID contractID = new ContractID((UUID)rs.getObject(&quot;contractID&quot;));</span>

<span class="fc" id="L617">			final Map&lt;InterfaceID, SessionInterface&gt; sessionInterfaces = new HashMap&lt;&gt;();</span>
<span class="fc" id="L618">			final UUID[] uuids = (UUID[]) rs.getArray(&quot;sessionInterfaces&quot;).getArray();</span>
<span class="fc bfc" id="L619" title="All 2 branches covered.">			for (final UUID curUUID : uuids) {</span>
<span class="fc" id="L620">				final SessionInterface sessIface = this.getSessionInterfaceByID(curUUID);</span>
<span class="fc" id="L621">				final InterfaceID ifaceID = sessIface.getInterfaceID();</span>
<span class="fc" id="L622">				sessionInterfaces.put(ifaceID, sessIface);</span>
			}

<span class="fc" id="L625">			Session = new SessionContract();</span>
<span class="fc" id="L626">			Session.setId(uuid);</span>
<span class="fc" id="L627">			Session.setContractID(contractID);</span>
<span class="fc" id="L628">			Session.setSessionInterfaces(sessionInterfaces);</span>

<span class="nc" id="L630">		} catch (final SQLException e) {</span>
<span class="nc" id="L631">			e.printStackTrace();</span>
<span class="fc" id="L632">		}</span>
<span class="fc" id="L633">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionInterface
	 */
	private SessionInterface deserializeSessionInterface(
			final ResultSet rs) {
<span class="fc" id="L644">		SessionInterface iface = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L647">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L648">			final InterfaceID interfaceID = new InterfaceID((UUID)rs.getObject(&quot;interfaceID&quot;));</span>
<span class="fc" id="L649">			final MetaClassID classOfInterface = new MetaClassID((UUID)rs.getObject(&quot;classOfInterface&quot;));</span>
<span class="fc" id="L650">			final InterfaceID importOfInterface = new InterfaceID((UUID)rs.getObject(&quot;importOfInterface&quot;));</span>

<span class="fc" id="L652">			final Map&lt;PropertyID, SessionProperty&gt; sessionProperties = new HashMap&lt;&gt;();</span>
<span class="fc" id="L653">			final Map&lt;OperationID, SessionOperation&gt; sessionOperations = new HashMap&lt;&gt;();</span>

<span class="fc" id="L655">			Array array = rs.getArray(&quot;sessionOperations&quot;);</span>
<span class="pc bpc" id="L656" title="1 of 2 branches missed.">			if (array != null) {</span>
<span class="fc" id="L657">				final UUID[] opsUUIDs = (UUID[]) array.getArray();</span>
<span class="fc bfc" id="L658" title="All 2 branches covered.">				for (final UUID opUUID : opsUUIDs) {</span>
<span class="fc" id="L659">					final SessionOperation op = this.getSessionOperationByID(opUUID);</span>
<span class="fc" id="L660">					final OperationID opID = op.getOperationID();</span>
<span class="fc" id="L661">					sessionOperations.put(opID, op);</span>
				}
			}

<span class="fc" id="L665">			array = rs.getArray(&quot;sessionProperties&quot;);</span>
<span class="pc bpc" id="L666" title="1 of 2 branches missed.">			if (array != null) {</span>
<span class="nc" id="L667">				final UUID[] propsUUIDs = (UUID[]) array.getArray();</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">				for (final UUID propUUID : propsUUIDs) {</span>
<span class="nc" id="L669">					final SessionProperty prop = this.getSessionPropertyByID(propUUID);</span>
<span class="nc" id="L670">					final PropertyID propID = prop.getPropertyID();</span>
<span class="nc" id="L671">					sessionProperties.put(propID, prop);</span>
				}
			}

<span class="fc" id="L675">			iface = new SessionInterface();</span>
<span class="fc" id="L676">			iface.setClassOfInterface(classOfInterface);</span>
<span class="fc" id="L677">			iface.setId(uuid);</span>
<span class="fc" id="L678">			iface.setImportOfInterface(importOfInterface);</span>
<span class="fc" id="L679">			iface.setInterfaceID(interfaceID);</span>
<span class="fc" id="L680">			iface.setSessionOperations(sessionOperations);</span>
<span class="fc" id="L681">			iface.setSessionProperties(sessionProperties);</span>

<span class="nc" id="L683">		} catch (final SQLException e) {</span>
<span class="nc" id="L684">			e.printStackTrace();</span>
<span class="fc" id="L685">		}</span>
<span class="fc" id="L686">		return iface;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionContract
	 */
	private SessionDataContract deserializeSessionDataContract(
			final ResultSet rs) {
<span class="fc" id="L697">		SessionDataContract Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L700">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L701">			final DataContractID datacontractID = new DataContractID((UUID)rs.getObject(&quot;datacontractID&quot;));</span>
<span class="fc" id="L702">			final DataSetID datasetOfProvider = new DataSetID((UUID)rs.getObject(&quot;datasetOfProvider&quot;));</span>

<span class="fc" id="L704">			Session = new SessionDataContract();</span>
<span class="fc" id="L705">			Session.setId(uuid);</span>
<span class="fc" id="L706">			Session.setDataContractID(datacontractID);</span>
<span class="fc" id="L707">			Session.setDataSetOfProvider(datasetOfProvider);</span>

<span class="nc" id="L709">		} catch (final SQLException e) {</span>
<span class="nc" id="L710">			e.printStackTrace();</span>
<span class="fc" id="L711">		}</span>
<span class="fc" id="L712">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionContract
	 */
	private Session deserializeSession(
			final ResultSet rs) {
<span class="fc" id="L723">		Session Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L726">			final SessionID sessionID = new SessionID((UUID)rs.getObject(&quot;id&quot;));</span>
<span class="fc" id="L727">			final AccountID accountID = new AccountID((UUID)rs.getObject(&quot;accountID&quot;));</span>

<span class="fc" id="L729">			final UUID[] propertiesOfClassesKeys = (UUID[]) rs.getArray(&quot;propertiesOfClassesKeys&quot;).getArray();</span>
<span class="fc" id="L730">			final UUID[] propertiesOfClassesValues = (UUID[]) rs.getArray(&quot;propertiesOfClassesValues&quot;).getArray();</span>
<span class="fc" id="L731">			final Map&lt;MetaClassID, Set&lt;PropertyID&gt;&gt; propertiesOfClasses = new HashMap&lt;&gt;();</span>
<span class="pc bpc" id="L732" title="1 of 2 branches missed.">			for (int i = 0; i &lt; propertiesOfClassesKeys.length; ++i) {</span>
<span class="nc" id="L733">				final MetaClassID classID = new MetaClassID(propertiesOfClassesKeys[i]);</span>
<span class="nc" id="L734">				Set&lt;PropertyID&gt; propIDs = propertiesOfClasses.get(classID);</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">				if (propIDs == null) {</span>
<span class="nc" id="L736">					propIDs = new HashSet&lt;&gt;();</span>
<span class="nc" id="L737">					propertiesOfClasses.put(classID, propIDs);</span>
				}
<span class="nc" id="L739">				final PropertyID propID = new PropertyID(propertiesOfClassesValues[i]);</span>
<span class="nc" id="L740">				propIDs.add(propID);</span>
			}

<span class="fc" id="L743">			final UUID[] sessionContractsKeys = (UUID[]) rs.getArray(&quot;sessionContractsKeys&quot;).getArray();</span>
<span class="fc" id="L744">			final UUID[] sessionContractsValues = (UUID[]) rs.getArray(&quot;sessionContractsValues&quot;).getArray();</span>
<span class="fc" id="L745">			final Map&lt;ContractID, SessionContract&gt; sessionContracts = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L746" title="All 2 branches covered.">			for (int i = 0; i &lt; sessionContractsKeys.length; ++i) {</span>
<span class="fc" id="L747">				final ContractID contractID = new ContractID(sessionContractsKeys[i]);</span>
<span class="fc" id="L748">				final SessionContract sessionContract = this.getSessionContractByID(sessionContractsValues[i]);</span>
<span class="fc" id="L749">				sessionContracts.put(contractID, sessionContract);</span>
			}

<span class="fc" id="L752">			final UUID[] sessionDataContractsKeys = (UUID[]) rs.getArray(&quot;sessionDataContractsKeys&quot;).getArray();</span>
<span class="fc" id="L753">			final UUID[] sessionDataContractsValues = (UUID[]) rs.getArray(&quot;sessionDataContractsValues&quot;).getArray();</span>
<span class="fc" id="L754">			final Map&lt;DataContractID, SessionDataContract&gt; sessionDataContracts = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L755" title="All 2 branches covered.">			for (int i = 0; i &lt; sessionDataContractsKeys.length; ++i) {</span>
<span class="fc" id="L756">				final DataContractID datacontractID = new DataContractID(sessionDataContractsKeys[i]);</span>
<span class="fc" id="L757">				final SessionDataContract sessionDataContract = this.getSessionDataContractByID(sessionDataContractsValues[i]);</span>
<span class="fc" id="L758">				sessionDataContracts.put(datacontractID, sessionDataContract);</span>
			}

<span class="fc" id="L761">			final Map&lt;MetaClassID, byte[]&gt; ifaceBitmaps = new HashMap&lt;&gt;();</span>
<span class="fc" id="L762">			final UUID[] ifaceBitmapsKeys = (UUID[]) rs.getArray(&quot;ifaceBitmapsKeys&quot;).getArray();</span>
<span class="fc" id="L763">			final String[] subRs = (String[]) rs.getArray(&quot;ifaceBitmapsValues&quot;).getArray();</span>
<span class="pc bpc" id="L764" title="1 of 2 branches missed.">			for (int i = 0; i &lt; ifaceBitmapsKeys.length; ++i) {</span>
<span class="nc" id="L765">				final MetaClassID classID = new MetaClassID(ifaceBitmapsKeys[i]);</span>
<span class="nc" id="L766">				final byte[] values = Utils.hexStringToByteArray(subRs[i]);</span>
<span class="nc" id="L767">				ifaceBitmaps.put(classID, values);</span>
			}

<span class="fc" id="L770">			final DataContractID dataContractIDforStore = new DataContractID((UUID)rs.getObject(&quot;dataContractIDforStore&quot;));</span>
<span class="fc" id="L771">			final Langs language = Langs.valueOf(rs.getString(&quot;language&quot;));</span>
<span class="fc" id="L772">			final Calendar endDate = Calendar.getInstance();</span>
<span class="fc" id="L773">			endDate.setTime(rs.getDate(&quot;endDate&quot;));</span>

<span class="fc" id="L775">			Session = new Session();</span>
<span class="fc" id="L776">			Session.setAccountID(accountID);</span>
<span class="fc" id="L777">			Session.setDataContractIDofStore(dataContractIDforStore);</span>
<span class="fc" id="L778">			Session.setEndDate(endDate);</span>
<span class="fc" id="L779">			Session.setIfaceBitmaps(ifaceBitmaps);</span>
<span class="fc" id="L780">			Session.setLanguage(language);</span>
<span class="fc" id="L781">			Session.setPropertiesOfClasses(propertiesOfClasses);</span>
<span class="fc" id="L782">			Session.setSessionContracts(sessionContracts);</span>
<span class="fc" id="L783">			Session.setSessionDataContracts(sessionDataContracts);</span>
<span class="fc" id="L784">			Session.setDataClayID(sessionID);</span>

<span class="nc" id="L786">		} catch (final SQLException e) {</span>
<span class="nc" id="L787">			e.printStackTrace();</span>
<span class="fc" id="L788">		}</span>
<span class="fc" id="L789">		return Session;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionProperty getSessionPropertyByID(final UUID uuid) throws SQLException {
<span class="nc" id="L801">		ResultSet rs = null;</span>
<span class="nc" id="L802">		SessionProperty info = null;</span>
<span class="nc" id="L803">		Connection conn = null;</span>
		try {
<span class="nc" id="L805">			conn = dataSource.getConnection();</span>
<span class="nc" id="L806">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONPROPERTY.getSqlStatement());</span>

<span class="nc" id="L808">			selectStatement.setObject(1, uuid);</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L810">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="nc" id="L812">			rs = selectStatement.executeQuery();</span>
<span class="nc bnc" id="L813" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L814">				info = deserializeSessionProperty(rs);</span>
			}

<span class="nc" id="L817">		} catch (final SQLException e) {</span>
<span class="nc" id="L818">			throw e;</span>
		} finally {
			try {
<span class="nc bnc" id="L821" title="All 2 branches missed.">				if (rs != null) {</span>
<span class="nc" id="L822">					rs.close();</span>
				}
<span class="nc bnc" id="L824" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L825">					conn.close();</span>
				}
<span class="nc" id="L827">			} catch (final SQLException e) {</span>
<span class="nc" id="L828">				e.printStackTrace();</span>
<span class="nc" id="L829">			}</span>
		}

<span class="nc" id="L832">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionImplementation getSessionImplementationByID(final UUID uuid) throws SQLException {
<span class="fc" id="L844">		ResultSet rs = null;</span>
<span class="fc" id="L845">		SessionImplementation info = null;</span>
<span class="fc" id="L846">		Connection conn = null;</span>
		try {
<span class="fc" id="L848">			conn = dataSource.getConnection();</span>
<span class="fc" id="L849">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONIMPLEMENTATION.getSqlStatement());</span>

<span class="fc" id="L851">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L852" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L853">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L855">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L856" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L857">				info = deserializeSessionImplementation(rs);</span>
			}

<span class="nc" id="L860">		} catch (final SQLException e) {</span>
<span class="nc" id="L861">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L864" title="1 of 2 branches missed.">				if (rs != null) {</span>
<span class="fc" id="L865">					rs.close();</span>
				}
<span class="pc bpc" id="L867" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L868">					conn.close();</span>
				}
<span class="nc" id="L870">			} catch (final SQLException e) {</span>
<span class="nc" id="L871">				e.printStackTrace();</span>
<span class="fc" id="L872">			}</span>
		}

<span class="fc" id="L875">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionOperation getSessionOperationByID(final UUID uuid) throws SQLException {
<span class="fc" id="L887">		ResultSet rs = null;</span>
<span class="fc" id="L888">		SessionOperation info = null;</span>
<span class="fc" id="L889">		Connection conn = null;</span>
		try {
<span class="fc" id="L891">			conn = dataSource.getConnection();</span>
<span class="fc" id="L892">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONOPERATION.getSqlStatement());</span>

<span class="fc" id="L894">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L895" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L896">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L898">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L899" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L900">				info = deserializeSessionOperation(rs);</span>
			}

<span class="nc" id="L903">		} catch (final SQLException e) {</span>
<span class="nc" id="L904">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L907" title="1 of 2 branches missed.">				if (rs != null) {</span>
<span class="fc" id="L908">					rs.close();</span>
				}
<span class="pc bpc" id="L910" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L911">					conn.close();</span>
				}
<span class="nc" id="L913">			} catch (final SQLException e) {</span>
<span class="nc" id="L914">				e.printStackTrace();</span>
<span class="fc" id="L915">			}</span>
		}

<span class="fc" id="L918">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionInterface getSessionInterfaceByID(final UUID uuid) throws SQLException {
<span class="fc" id="L930">		ResultSet rs = null;</span>
<span class="fc" id="L931">		SessionInterface info = null;</span>
<span class="fc" id="L932">		Connection conn = null;</span>
		try {
<span class="fc" id="L934">			conn = dataSource.getConnection();</span>
<span class="fc" id="L935">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONINTERFACE.getSqlStatement());</span>

<span class="fc" id="L937">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L938" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L939">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L941">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L942" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L943">				info = deserializeSessionInterface(rs);</span>
			}

<span class="nc" id="L946">		} catch (final SQLException e) {</span>
<span class="nc" id="L947">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L950" title="1 of 2 branches missed.">				if (rs != null) {</span>
<span class="fc" id="L951">					rs.close();</span>
				}
<span class="pc bpc" id="L953" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L954">					conn.close();</span>
				}
<span class="nc" id="L956">			} catch (final SQLException e) {</span>
<span class="nc" id="L957">				e.printStackTrace();</span>
<span class="fc" id="L958">			}</span>
		}

<span class="fc" id="L961">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionContract getSessionContractByID(final UUID uuid) throws SQLException {
<span class="fc" id="L973">		ResultSet rs = null;</span>
<span class="fc" id="L974">		SessionContract info = null;</span>
<span class="fc" id="L975">		Connection conn = null;</span>
		try {
<span class="fc" id="L977">			conn = dataSource.getConnection();</span>
<span class="fc" id="L978">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONCONTRACT.getSqlStatement());</span>

<span class="fc" id="L980">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L981" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L982">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L984">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L985" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L986">				info = deserializeSessionContract(rs);</span>
			}

<span class="nc" id="L989">		} catch (final SQLException e) {</span>
<span class="nc" id="L990">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L993" title="1 of 2 branches missed.">				if (rs != null) {</span>
<span class="fc" id="L994">					rs.close();</span>
				}
<span class="pc bpc" id="L996" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L997">					conn.close();</span>
				}
<span class="nc" id="L999">			} catch (final SQLException e) {</span>
<span class="nc" id="L1000">				e.printStackTrace();</span>
<span class="fc" id="L1001">			}</span>
		}

<span class="fc" id="L1004">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionDataContract getSessionDataContractByID(final UUID uuid) throws SQLException {
<span class="fc" id="L1016">		ResultSet rs = null;</span>
<span class="fc" id="L1017">		SessionDataContract info = null;</span>
<span class="fc" id="L1018">		Connection conn = null;</span>
		try {
<span class="fc" id="L1020">			conn = dataSource.getConnection();</span>
<span class="fc" id="L1021">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONDATACONTRACT.getSqlStatement());</span>

<span class="fc" id="L1023">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L1024" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1025">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L1027">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L1028" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L1029">				info = deserializeSessionDataContract(rs);</span>
			}

<span class="nc" id="L1032">		} catch (final SQLException e) {</span>
<span class="nc" id="L1033">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L1036" title="1 of 2 branches missed.">				if (rs != null) {</span>
<span class="fc" id="L1037">					rs.close();</span>
				}
<span class="pc bpc" id="L1039" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L1040">					conn.close();</span>
				}
<span class="nc" id="L1042">			} catch (final SQLException e) {</span>
<span class="nc" id="L1043">				e.printStackTrace();</span>
<span class="fc" id="L1044">			}</span>
		}

<span class="fc" id="L1047">		return info;</span>
	}

	/**
	 * Get session info by ID
	 * @param sessionID
	 *            ID of the session
	 * @return The info of the session. Null if it is not registered.
	 */
	public Session getSessionByID(final SessionID sessionID) {
<span class="fc" id="L1057">		ResultSet rs = null;</span>
<span class="fc" id="L1058">		Session info = null;</span>
<span class="fc" id="L1059">		Connection conn = null;</span>
		try {
<span class="fc" id="L1061">			conn = dataSource.getConnection();</span>
<span class="fc" id="L1062">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONINFO.getSqlStatement());</span>

<span class="fc" id="L1064">			selectStatement.setObject(1, sessionID.getId());</span>
<span class="pc bpc" id="L1065" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1066">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L1068">			rs = selectStatement.executeQuery();</span>
<span class="fc bfc" id="L1069" title="All 2 branches covered.">			if (rs.next()) {</span>
<span class="fc" id="L1070">				info = deserializeSession(rs);</span>
			}

<span class="nc" id="L1073">		} catch (final SQLException e) {</span>
<span class="nc" id="L1074">			return null;</span>
		} finally {
			try {
<span class="pc bpc" id="L1077" title="1 of 2 branches missed.">				if (rs != null) {</span>
<span class="fc" id="L1078">					rs.close();</span>
				}
<span class="pc bpc" id="L1080" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L1081">					conn.close();</span>
				}
<span class="nc" id="L1083">			} catch (final SQLException e) {</span>
<span class="nc" id="L1084">				e.printStackTrace();</span>
<span class="fc" id="L1085">			}</span>
		}

<span class="fc" id="L1088">		return info;</span>
	}

	/**
	 * Get Sessions of account
	 * @param accountID
	 *            AccountID ID
	 * @return The Sessions
	 */
	public List&lt;Session&gt; getSessionsOfAccount(final AccountID accountID) {
<span class="nc" id="L1098">		ResultSet rs = null;</span>
<span class="nc" id="L1099">		final List&lt;Session&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1100">		Connection conn = null;</span>
		try {
<span class="nc" id="L1102">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1103">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONS_OF_ACCOUNT.getSqlStatement());</span>

<span class="nc" id="L1105">			selectStatement.setObject(1, accountID.getId());</span>
<span class="nc bnc" id="L1106" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1107">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="nc" id="L1109">			rs = selectStatement.executeQuery();</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1111">				result.add(deserializeSession(rs));</span>
			}
<span class="nc" id="L1113">		} catch (final SQLException e) {</span>
<span class="nc" id="L1114">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1117" title="All 2 branches missed.">				if (rs != null) {</span>
<span class="nc" id="L1118">					rs.close();</span>
				}
<span class="nc bnc" id="L1120" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1121">					conn.close();</span>
				}
<span class="nc" id="L1123">			} catch (final SQLException e) {</span>
<span class="nc" id="L1124">				e.printStackTrace();</span>
<span class="nc" id="L1125">			}</span>
		}

<span class="nc" id="L1128">		return result;</span>
	}

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 */
	private void deleteSessionDataContract(final UUID uuid) {

<span class="nc" id="L1138">		Connection conn = null;</span>
		try {
<span class="nc" id="L1140">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1141">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONDATACONTRACT.getSqlStatement());</span>
<span class="nc" id="L1142">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1144" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1145">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1147">			stmt.executeUpdate();</span>

<span class="nc" id="L1149">		} catch (final Exception e) {</span>
<span class="nc" id="L1150">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1153" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1154">					conn.close();</span>
				}
<span class="nc" id="L1156">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1157">				ex1.printStackTrace();</span>
<span class="nc" id="L1158">			}</span>
		}
<span class="nc" id="L1160">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 */
	private void deleteSessionImplementation(final UUID uuid) {

<span class="nc" id="L1169">		Connection conn = null;</span>
		try {
<span class="nc" id="L1171">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1172">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONIMPLEMENTATION.getSqlStatement());</span>
<span class="nc" id="L1173">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1175" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1176">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1178">			stmt.executeUpdate();</span>

<span class="nc" id="L1180">		} catch (final Exception e) {</span>
<span class="nc" id="L1181">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1184" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1185">					conn.close();</span>
				}
<span class="nc" id="L1187">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1188">				ex1.printStackTrace();</span>
<span class="nc" id="L1189">			}</span>
		}
<span class="nc" id="L1191">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private void deleteSessionOperation(final UUID uuid) throws SQLException {

<span class="nc" id="L1202">		final SessionOperation sessOperation = this.getSessionOperationByID(uuid);</span>
<span class="nc" id="L1203">		this.deleteSessionImplementation(sessOperation.getSessionLocalImplementation().getId());</span>
<span class="nc" id="L1204">		this.deleteSessionImplementation(sessOperation.getSessionRemoteImplementation().getId());</span>

<span class="nc" id="L1206">		Connection conn = null;</span>
		try {
<span class="nc" id="L1208">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1209">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONOPERATION.getSqlStatement());</span>
<span class="nc" id="L1210">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1212" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1213">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1215">			stmt.executeUpdate();</span>

<span class="nc" id="L1217">		} catch (final Exception e) {</span>
<span class="nc" id="L1218">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1221" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1222">					conn.close();</span>
				}
<span class="nc" id="L1224">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1225">				ex1.printStackTrace();</span>
<span class="nc" id="L1226">			}</span>
		}
<span class="nc" id="L1228">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 */
	private void deleteSessionProperty(final UUID uuid) {

<span class="nc" id="L1237">		Connection conn = null;</span>
		try {
<span class="nc" id="L1239">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1240">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONPROPERTY.getSqlStatement());</span>
<span class="nc" id="L1241">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1243" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1244">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1246">			stmt.executeUpdate();</span>

<span class="nc" id="L1248">		} catch (final Exception e) {</span>
<span class="nc" id="L1249">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1252" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1253">					conn.close();</span>
				}
<span class="nc" id="L1255">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1256">				ex1.printStackTrace();</span>
<span class="nc" id="L1257">			}</span>
		}
<span class="nc" id="L1259">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private void deleteSessionInterface(final UUID uuid) throws SQLException {

<span class="nc" id="L1270">		final SessionInterface sessIface = this.getSessionInterfaceByID(uuid);</span>
<span class="nc bnc" id="L1271" title="All 2 branches missed.">		for (final SessionOperation sessOp : sessIface.getSessionOperations().values()) {</span>
<span class="nc" id="L1272">			this.deleteSessionOperation(sessOp.getId());</span>
<span class="nc" id="L1273">		}</span>
<span class="nc bnc" id="L1274" title="All 2 branches missed.">		for (final SessionProperty sessProp : sessIface.getSessionProperties().values()) {</span>
<span class="nc" id="L1275">			this.deleteSessionProperty(sessProp.getId());</span>
<span class="nc" id="L1276">		}</span>

<span class="nc" id="L1278">		Connection conn = null;</span>
		try {
<span class="nc" id="L1280">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1281">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONINTERFACE.getSqlStatement());</span>
<span class="nc" id="L1282">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1284" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1285">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1287">			stmt.executeUpdate();</span>

<span class="nc" id="L1289">		} catch (final Exception e) {</span>
<span class="nc" id="L1290">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1293" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1294">					conn.close();</span>
				}
<span class="nc" id="L1296">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1297">				ex1.printStackTrace();</span>
<span class="nc" id="L1298">			}</span>
		}
<span class="nc" id="L1300">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private void deleteSessionContract(final UUID uuid) throws SQLException {

<span class="nc" id="L1311">		final SessionContract sessContract = this.getSessionContractByID(uuid);</span>
<span class="nc bnc" id="L1312" title="All 2 branches missed.">		for (final SessionInterface sessIface : sessContract.getSessionInterfaces().values()) {</span>
<span class="nc" id="L1313">			this.deleteSessionInterface(sessIface.getId());</span>
<span class="nc" id="L1314">		}</span>

<span class="nc" id="L1316">		Connection conn = null;</span>
		try {
<span class="nc" id="L1318">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1319">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONCONTRACT.getSqlStatement());</span>
<span class="nc" id="L1320">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1322" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1323">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1325">			stmt.executeUpdate();</span>

<span class="nc" id="L1327">		} catch (final Exception e) {</span>
<span class="nc" id="L1328">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1331" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1332">					conn.close();</span>
				}
<span class="nc" id="L1334">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1335">				ex1.printStackTrace();</span>
<span class="nc" id="L1336">			}</span>
		}
<span class="nc" id="L1338">	}</span>

	/**
	 * Delete accessedImplementation
	 * @param sessionID
	 *            ID of object to delete
	 */
	public void deleteSession(final SessionID sessionID) {

<span class="nc" id="L1347">		Connection conn = null;</span>
		try {

<span class="nc" id="L1350">			final Session sessInfo = this.getSessionByID(sessionID);</span>
<span class="nc bnc" id="L1351" title="All 2 branches missed.">			for (final SessionContract sessContract : sessInfo.getSessionContracts().values()) {</span>
<span class="nc" id="L1352">				this.deleteSessionContract(sessContract.getId());</span>
<span class="nc" id="L1353">			}</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">			for (final SessionDataContract sessDataContract : sessInfo.getSessionDataContracts().values()) {</span>
<span class="nc" id="L1355">				this.deleteSessionDataContract(sessDataContract.getId());</span>
<span class="nc" id="L1356">			}</span>

<span class="nc" id="L1358">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1359">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONINFO.getSqlStatement());</span>
<span class="nc" id="L1360">			stmt.setObject(1, sessionID.getId());</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1362" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1363">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1365">			stmt.executeUpdate();</span>

<span class="nc" id="L1367">		} catch (final Exception e) {</span>
<span class="nc" id="L1368">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1371" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1372">					conn.close();</span>
				}
<span class="nc" id="L1374">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1375">				ex1.printStackTrace();</span>
<span class="nc" id="L1376">			}</span>
		}
<span class="nc" id="L1378">	}</span>

	/**
	 * Close DB.
	 */
	public void close() {
		try {
<span class="fc" id="L1385">			dataSource.close();</span>
<span class="nc" id="L1386">		}catch(Exception e) {</span>
			// TODO
<span class="nc" id="L1388">			e.printStackTrace();</span>
<span class="fc" id="L1389">		}</span>
<span class="fc" id="L1390">	}</span>

	/**
	 * Check if session exists
	 * @param sessionID
	 *            session iD
	 * @return TRUE if exists.
	 */
	public boolean existsObjectByID(final SessionID sessionID) {
<span class="pc bpc" id="L1399" title="1 of 2 branches missed.">		return this.getSessionByID(sessionID) != null;</span>
	}

	/**
	 * Store external session.
	 * @param infoSession
	 *            info of the external session to be stored
	 */
	public void storeExt(final Session infoSession) {
<span class="nc" id="L1408">		try (Connection conn = dataSource.getConnection()) {</span>
<span class="nc" id="L1409">			try (PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_EXT_SESSION.getSqlStatement())) {</span>
<span class="nc" id="L1410">				insertStatement.setObject(1, infoSession.getExtDataClayID().getId());</span>
<span class="nc" id="L1411">				insertStatement.setObject(2, infoSession.getDataClayID().getId());</span>
<span class="nc" id="L1412">				insertStatement.setObject(3, infoSession.getAccountID().getId());</span>
<span class="nc" id="L1413">				insertStatement.setString(4, infoSession.getLanguage().name());</span>
<span class="nc" id="L1414">				insertStatement.setDate(5, new java.sql.Date(infoSession.getEndDate().getTimeInMillis()));</span>
<span class="nc" id="L1415">				insertStatement.executeUpdate();</span>
			}
<span class="nc" id="L1417">		} catch (final Exception e) {</span>
			// Ignore
<span class="nc" id="L1419">		}</span>
<span class="nc" id="L1420">	}</span>

	/**
	 * Get info about an external session
	 * @param extDataClayID
	 *            id of the external dataClay instance
	 * @return session info. null if there is no session for the given dataClay instance.
	 */
	public Session getExtSession(final DataClayInstanceID extDataClayID) {
<span class="nc" id="L1429">		try (Connection conn = dataSource.getConnection()) {</span>
<span class="nc" id="L1430">			try (PreparedStatement queryStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_EXT_SESSION.getSqlStatement())) {</span>
<span class="nc" id="L1431">				try (ResultSet rs = queryStatement.executeQuery()) {</span>
<span class="nc" id="L1432">					final SessionID sessionID = new SessionID((UUID)rs.getObject(&quot;sessionID&quot;));</span>
<span class="nc" id="L1433">					final AccountID accountID = new AccountID((UUID)rs.getObject(&quot;accountID&quot;));</span>
<span class="nc" id="L1434">					final Langs language = Langs.valueOf(rs.getString(&quot;language&quot;));</span>
<span class="nc" id="L1435">					final Calendar endDate = Calendar.getInstance();</span>
<span class="nc" id="L1436">					endDate.setTime(rs.getDate(&quot;endDate&quot;));</span>
<span class="nc" id="L1437">					final Session result = new Session();</span>
<span class="nc" id="L1438">					result.setDataClayID(sessionID);</span>
<span class="nc" id="L1439">					result.setAccountID(accountID);</span>
<span class="nc" id="L1440">					result.setExtDataClayID(extDataClayID);</span>
<span class="nc" id="L1441">					result.setLanguage(language);</span>
<span class="nc" id="L1442">					result.setEndDate(endDate);</span>
<span class="nc" id="L1443">					return result;</span>
				}
			}
<span class="nc" id="L1446">		} catch (final Exception e) {</span>
<span class="nc" id="L1447">			return null;</span>
		}
	}

	public void deleteExtSession(final DataClayInstanceID dataClayID) {
<span class="nc" id="L1452">		try (Connection conn = dataSource.getConnection()) {</span>
<span class="nc" id="L1453">			try (PreparedStatement deleteStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_EXT_SESSION.getSqlStatement())) {</span>
<span class="nc" id="L1454">				deleteStatement.setObject(1, dataClayID.getId());</span>
<span class="nc" id="L1455">				deleteStatement.executeUpdate();</span>
			}
<span class="nc" id="L1457">		} catch (final Exception ex) {</span>
			// ignore
<span class="nc" id="L1459">		}</span>
<span class="nc" id="L1460">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>