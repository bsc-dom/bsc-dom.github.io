<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SessionManagerDB.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">dataclay</a> &gt; <a href="index.source.html" class="el_package">es.bsc.dataclay.logic.sessionmgr</a> &gt; <span class="el_source">SessionManagerDB.java</span></div><h1>SessionManagerDB.java</h1><pre class="source lang-java linenums">
package es.bsc.dataclay.logic.sessionmgr;

import java.sql.Array;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.UUID;

import org.apache.commons.codec.DecoderException;
import org.apache.commons.dbcp2.BasicDataSource;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import es.bsc.dataclay.communication.grpc.messages.common.CommonMessages.Langs;
import es.bsc.dataclay.dbhandler.Utils;
import es.bsc.dataclay.exceptions.dbhandler.DbObjectAlreadyExistException;
import es.bsc.dataclay.util.Configuration;
import es.bsc.dataclay.util.ids.AccountID;
import es.bsc.dataclay.util.ids.ContractID;
import es.bsc.dataclay.util.ids.DataClayInstanceID;
import es.bsc.dataclay.util.ids.DataContractID;
import es.bsc.dataclay.util.ids.DataSetID;
import es.bsc.dataclay.util.ids.ImplementationID;
import es.bsc.dataclay.util.ids.InterfaceID;
import es.bsc.dataclay.util.ids.MetaClassID;
import es.bsc.dataclay.util.ids.NamespaceID;
import es.bsc.dataclay.util.ids.OperationID;
import es.bsc.dataclay.util.ids.PropertyID;
import es.bsc.dataclay.util.ids.SessionID;
import es.bsc.dataclay.util.management.sessionmgr.SessionContract;
import es.bsc.dataclay.util.management.sessionmgr.SessionDataContract;
import es.bsc.dataclay.util.management.sessionmgr.SessionImplementation;
import es.bsc.dataclay.util.management.sessionmgr.SessionInterface;
import es.bsc.dataclay.util.management.sessionmgr.SessionOperation;
import es.bsc.dataclay.util.management.sessionmgr.SessionProperty;
import es.bsc.dataclay.dbhandler.sql.sqlite.SQLiteDataSource;

/**
 * Data base connection.
 */
public final class SessionManagerDB {

	/** Data source. */
	private final SQLiteDataSource dataSource;

	/** Logger. */
	private Logger logger;

	/** Indicates if debug is enabled. */
<span class="fc" id="L60">	private static final boolean DEBUG_ENABLED = Configuration.isDebugEnabled();</span>

	/**
	 * Constructor.
	 *
	 */
<span class="fc" id="L66">	public SessionManagerDB(final SQLiteDataSource dataSource) {</span>
<span class="fc" id="L67">		this.dataSource = dataSource;</span>
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">		if (DEBUG_ENABLED) {</span>
<span class="nc" id="L69">			logger = LogManager.getLogger(&quot;LMDB&quot;);</span>
		}
<span class="fc" id="L71">	}</span>

	/**
	 * Create tables of MDS.
	 */
	public void createTables() {
<span class="fc" id="L77">		synchronized (dataSource) {</span>

<span class="fc" id="L79">			Connection conn = null;</span>
			try {
<span class="fc" id="L81">				conn = dataSource.getConnection();</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">				for (final SessionManagerSQLStatements.SqlStatements stmt : SessionManagerSQLStatements.SqlStatements.values()) {</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">					if (stmt.name().startsWith(&quot;CREATE_TABLE&quot;)) {</span>
<span class="fc" id="L84">						final PreparedStatement updateStatement = conn.prepareStatement(stmt.getSqlStatement());</span>
<span class="fc" id="L85">						updateStatement.execute();</span>
<span class="fc" id="L86">						updateStatement.close();</span>
					}
				}
<span class="nc" id="L89">			} catch (final SQLException e) {</span>
<span class="nc" id="L90">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L94">						conn.close();</span>
					}
<span class="nc" id="L96">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L97">					ex1.printStackTrace();</span>
<span class="fc" id="L98">				}</span>
			}
<span class="fc" id="L100">		}</span>
<span class="fc" id="L101">	}</span>

	/**
	 * Delete the tables of MDS. Just the other way around of createTables --much simpler.
	 */
	public void dropTables() {
<span class="fc" id="L107">		synchronized (dataSource) {</span>

<span class="fc" id="L109">			Connection conn = null;</span>
			try {
<span class="fc" id="L111">				conn = dataSource.getConnection();</span>
<span class="fc bfc" id="L112" title="All 2 branches covered.">				for (final SessionManagerSQLStatements.SqlStatements stmt : SessionManagerSQLStatements.SqlStatements.values()) {</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">					if (stmt.name().startsWith(&quot;DROP_TABLE&quot;)) {</span>
<span class="fc" id="L114">						final PreparedStatement updateStatement = conn.prepareStatement(stmt.getSqlStatement());</span>
<span class="fc" id="L115">						updateStatement.execute();</span>
<span class="fc" id="L116">						updateStatement.close();</span>
					}
				}
<span class="nc" id="L119">			} catch (final SQLException e) {</span>
<span class="nc" id="L120">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L124">						conn.close();</span>
					}
<span class="nc" id="L126">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L127">					ex1.printStackTrace();</span>
<span class="fc" id="L128">				}</span>
			}
<span class="fc" id="L130">		}</span>
<span class="fc" id="L131">	}</span>

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionInterface infoSession) {

<span class="fc" id="L141">		UUID[] sessPropsUUIDs = null;</span>
<span class="pc bpc" id="L142" title="1 of 2 branches missed.">		if (infoSession.getSessionProperties() != null) {</span>
<span class="nc" id="L143">			sessPropsUUIDs = new UUID[infoSession.getSessionProperties().size()];</span>
<span class="nc" id="L144">			int i = 0;</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">			for (final SessionProperty sessProp : infoSession.getSessionProperties().values()) {</span>
<span class="nc" id="L146">				sessPropsUUIDs[i] = this.store(sessProp);</span>
<span class="nc" id="L147">				i++;</span>
<span class="nc" id="L148">			}</span>
		}

<span class="fc" id="L151">		UUID[] sessOpsUUIDs = null;</span>
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">		if (infoSession.getSessionOperations() != null) {</span>
<span class="fc" id="L153">			sessOpsUUIDs = new UUID[infoSession.getSessionOperations().size()];</span>
<span class="fc" id="L154">			int i = 0;</span>
<span class="fc bfc" id="L155" title="All 2 branches covered.">			for (final SessionOperation sessOp : infoSession.getSessionOperations().values()) {</span>
<span class="fc" id="L156">				sessOpsUUIDs[i] = this.store(sessOp);</span>
<span class="fc" id="L157">				i++;</span>
<span class="fc" id="L158">			}</span>
		}

<span class="fc" id="L161">		Connection conn = null;</span>
<span class="fc" id="L162">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L163">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L165">			conn = dataSource.getConnection();</span>
<span class="fc" id="L166">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONINTERFACE.getSqlStatement());</span>
<span class="fc" id="L167">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF

<span class="fc" id="L170">			insertStatement.setObject(2, infoSession.getInterfaceID().getId());</span>
<span class="pc bpc" id="L171" title="1 of 2 branches missed.">			if (sessPropsUUIDs != null) {</span>
<span class="nc" id="L172">				final Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessPropsUUIDs);</span>
<span class="nc" id="L173">				insertStatement.setArray(3, tArray);</span>
<span class="nc" id="L174">			} else {</span>
<span class="fc" id="L175">				insertStatement.setArray(3, null);</span>
			}

<span class="pc bpc" id="L178" title="1 of 2 branches missed.">			if (sessOpsUUIDs != null) {</span>
<span class="fc" id="L179">				final Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessOpsUUIDs);</span>
<span class="fc" id="L180">				insertStatement.setArray(4, tArray);</span>
<span class="fc" id="L181">			} else {</span>
<span class="nc" id="L182">				insertStatement.setArray(4, null);</span>
			}

<span class="fc" id="L185">			insertStatement.setObject(5, infoSession.getClassOfInterface().getId());</span>

<span class="pc bpc" id="L187" title="1 of 2 branches missed.">			if (infoSession.getImportOfInterface() != null) {</span>
<span class="nc" id="L188">				insertStatement.setObject(6, infoSession.getImportOfInterface().getId());</span>
			} else {
<span class="fc" id="L190">				insertStatement.setObject(6, null);</span>
			}

			// CHECKSTYLE:ON
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L195">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L197">			insertStatement.executeUpdate();</span>
<span class="fc" id="L198">			insertStatement.close();</span>
<span class="nc" id="L199">		} catch (final Exception e) {</span>
<span class="nc" id="L200">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L204">					conn.close();</span>
				}
<span class="nc" id="L206">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L207">				ex1.printStackTrace();</span>
<span class="fc" id="L208">			}</span>
		}
<span class="fc" id="L210">		return uuid;</span>
	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionContract infoSession) {

<span class="fc" id="L221">		final UUID[] sessInterfaceIDs = new UUID[infoSession.getSessionInterfaces().size()];</span>
<span class="fc" id="L222">		int i = 0;</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">		for (final SessionInterface sessionIface : infoSession.getSessionInterfaces().values()) {</span>
<span class="fc" id="L224">			sessInterfaceIDs[i] = this.store(sessionIface);</span>
<span class="fc" id="L225">			i++;</span>
<span class="fc" id="L226">		}</span>

<span class="fc" id="L228">		Connection conn = null;</span>
<span class="fc" id="L229">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L230">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L232">			conn = dataSource.getConnection();</span>
<span class="fc" id="L233">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONCONTRACT.getSqlStatement());</span>
<span class="fc" id="L234">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF
<span class="fc" id="L236">			insertStatement.setObject(2, infoSession.getContractID().getId());</span>

<span class="fc" id="L238">			final Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessInterfaceIDs);</span>
<span class="fc" id="L239">			insertStatement.setArray(3, tArray);</span>

			// CHECKSTYLE:ON
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L243">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L245">			insertStatement.executeUpdate();</span>
<span class="fc" id="L246">			insertStatement.close();</span>

<span class="nc" id="L248">		} catch (final Exception e) {</span>
<span class="nc" id="L249">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L253">					conn.close();</span>
				}
<span class="nc" id="L255">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L256">				ex1.printStackTrace();</span>
<span class="fc" id="L257">			}</span>
		}
<span class="fc" id="L259">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionProperty infoSession) {
<span class="nc" id="L270">		Connection conn = null;</span>
<span class="nc" id="L271">		final UUID uuid = UUID.randomUUID();</span>
<span class="nc" id="L272">		infoSession.setId(uuid);</span>
		try {
<span class="nc" id="L274">			conn = dataSource.getConnection();</span>
<span class="nc" id="L275">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONPROPERTY.getSqlStatement());</span>
<span class="nc" id="L276">			insertStatement.setObject(1, uuid);</span>
<span class="nc" id="L277">			insertStatement.setObject(2, infoSession.getPropertyID().getId());</span>
			// CHECKSTYLE:OFF
			// CHECKSTYLE:ON
<span class="nc bnc" id="L280" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L281">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="nc" id="L283">			insertStatement.executeUpdate();</span>
<span class="nc" id="L284">			insertStatement.close();</span>

<span class="nc" id="L286">		} catch (final Exception e) {</span>
<span class="nc" id="L287">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L290" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L291">					conn.close();</span>
				}
<span class="nc" id="L293">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L294">				ex1.printStackTrace();</span>
<span class="nc" id="L295">			}</span>
		}
<span class="nc" id="L297">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionImplementation infoSession) {
<span class="nc" id="L308">		Connection conn = null;</span>
<span class="nc" id="L309">		final UUID uuid = UUID.randomUUID();</span>
<span class="nc" id="L310">		infoSession.setId(uuid);</span>
		try {
<span class="nc" id="L312">			conn = dataSource.getConnection();</span>
<span class="nc" id="L313">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONIMPLEMENTATION.getSqlStatement());</span>
<span class="nc" id="L314">			insertStatement.setObject(1, uuid);</span>
<span class="nc" id="L315">			insertStatement.setObject(2, infoSession.getImplementationID().getId());</span>
			// CHECKSTYLE:OFF
<span class="nc" id="L317">			insertStatement.setObject(3, infoSession.getNamespaceID().getId());</span>
<span class="nc" id="L318">			insertStatement.setObject(4, infoSession.getRespAccountID().getId());</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L320" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L321">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="nc" id="L323">			insertStatement.executeUpdate();</span>
<span class="nc" id="L324">			insertStatement.close();</span>

<span class="nc" id="L326">		} catch (final Exception e) {</span>
<span class="nc" id="L327">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L330" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L331">					conn.close();</span>
				}
<span class="nc" id="L333">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L334">				ex1.printStackTrace();</span>
<span class="nc" id="L335">			}</span>
		}
<span class="nc" id="L337">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionOperation infoSession) {

<span class="fc" id="L349">		UUID localImplUUID = null;</span>
<span class="pc bpc" id="L350" title="1 of 2 branches missed.">		if (infoSession.getSessionLocalImplementation() != null) {</span>
<span class="nc" id="L351">			localImplUUID = this.store(infoSession.getSessionLocalImplementation());</span>
		}

<span class="fc" id="L354">		UUID remoteImplUUID = null;</span>
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">		if (infoSession.getSessionRemoteImplementation() != null) {</span>
<span class="nc" id="L356">			remoteImplUUID = this.store(infoSession.getSessionRemoteImplementation());</span>
		}

<span class="fc" id="L359">		Connection conn = null;</span>
<span class="fc" id="L360">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L361">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L363">			conn = dataSource.getConnection();</span>
<span class="fc" id="L364">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONOPERATION.getSqlStatement());</span>
<span class="fc" id="L365">			insertStatement.setObject(1, uuid);</span>
<span class="fc" id="L366">			insertStatement.setObject(2, infoSession.getOperationID().getId());</span>
			// CHECKSTYLE:OFF

<span class="fc" id="L369">			insertStatement.setObject(3, localImplUUID);</span>
<span class="fc" id="L370">			insertStatement.setObject(4, remoteImplUUID);</span>

			// CHECKSTYLE:ON
<span class="pc bpc" id="L373" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L374">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L376">			insertStatement.executeUpdate();</span>
<span class="fc" id="L377">			insertStatement.close();</span>

<span class="nc" id="L379">		} catch (final Exception e) {</span>
<span class="nc" id="L380">			e.printStackTrace();</span>
<span class="nc" id="L381">			throw new DbObjectAlreadyExistException(infoSession.getOperationID());</span>
		} finally {
			try {
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L385">					conn.close();</span>
				}
<span class="nc" id="L387">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L388">				ex1.printStackTrace();</span>
<span class="fc" id="L389">			}</span>
		}
<span class="fc" id="L391">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 * @return UUID of object stored
	 */
	private UUID store(final SessionDataContract infoSession) {
<span class="fc" id="L402">		Connection conn = null;</span>
<span class="fc" id="L403">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L404">		infoSession.setId(uuid);</span>
		try {
<span class="fc" id="L406">			conn = dataSource.getConnection();</span>
<span class="fc" id="L407">			final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONDATACONTRACT.getSqlStatement());</span>
<span class="fc" id="L408">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF
<span class="fc" id="L410">			insertStatement.setObject(2, infoSession.getDataContractID().getId());</span>
<span class="fc" id="L411">			insertStatement.setObject(3, infoSession.getDataSetOfProvider().getId());</span>
			// CHECKSTYLE:ON
<span class="pc bpc" id="L413" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L414">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L416">			insertStatement.executeUpdate();</span>
<span class="fc" id="L417">			insertStatement.close();</span>

<span class="nc" id="L419">		} catch (final Exception e) {</span>
<span class="nc" id="L420">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L423" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L424">					conn.close();</span>
				}
<span class="nc" id="L426">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L427">				ex1.printStackTrace();</span>
<span class="fc" id="L428">			}</span>
		}
<span class="fc" id="L430">		return uuid;</span>

	}

	/**
	 * Store into database
	 * @param infoSession
	 *            Object to store
	 */
	public void store(final Session infoSession) {
<span class="fc" id="L440">		synchronized (dataSource) {</span>

<span class="fc" id="L442">			final List&lt;UUID&gt; propKeysList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L443">			final List&lt;UUID&gt; propValuesList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L444">			int i = 0;</span>
<span class="fc bfc" id="L445" title="All 2 branches covered.">			for (final Entry&lt;MetaClassID, Set&lt;PropertyID&gt;&gt; entry : infoSession.getPropertiesOfClasses().entrySet()) {</span>
<span class="fc" id="L446">				final MetaClassID classID = entry.getKey();</span>
<span class="pc bpc" id="L447" title="1 of 2 branches missed.">				for (final PropertyID propID : entry.getValue()) {</span>
<span class="nc" id="L448">					propKeysList.add(classID.getId());</span>
<span class="nc" id="L449">					propValuesList.add(propID.getId());</span>
<span class="nc" id="L450">					i++;</span>
<span class="nc" id="L451">				}</span>
<span class="fc" id="L452">			}</span>

<span class="fc" id="L454">			final UUID[] propKeys = propKeysList.toArray(new UUID[propKeysList.size()]);</span>
<span class="fc" id="L455">			final UUID[] propValues = propValuesList.toArray(new UUID[propValuesList.size()]);</span>
<span class="fc" id="L456">			final UUID[] sessContractKeys = new UUID[infoSession.getSessionContracts().size()];</span>
<span class="fc" id="L457">			final UUID[] sessContractValues = new UUID[infoSession.getSessionContracts().size()];</span>
<span class="fc" id="L458">			i = 0;</span>
<span class="fc bfc" id="L459" title="All 2 branches covered.">			for (final Entry&lt;ContractID, SessionContract&gt; entry : infoSession.getSessionContracts().entrySet()) {</span>
<span class="fc" id="L460">				sessContractKeys[i] = entry.getKey().getId();</span>
<span class="fc" id="L461">				sessContractValues[i] = this.store(entry.getValue());</span>
<span class="fc" id="L462">				i++;</span>
<span class="fc" id="L463">			}</span>

<span class="fc" id="L465">			final UUID[] sessDataContractKeys = new UUID[infoSession.getSessionDataContracts().size()];</span>
<span class="fc" id="L466">			final UUID[] sessDataContractValues = new UUID[infoSession.getSessionDataContracts().size()];</span>
<span class="fc" id="L467">			i = 0;</span>
<span class="fc bfc" id="L468" title="All 2 branches covered.">			for (final Entry&lt;DataContractID, SessionDataContract&gt; entry : infoSession.getSessionDataContracts().entrySet()) {</span>
<span class="fc" id="L469">				sessDataContractKeys[i] = entry.getKey().getId();</span>
<span class="fc" id="L470">				sessDataContractValues[i] = this.store(entry.getValue());</span>
<span class="fc" id="L471">				i++;</span>
<span class="fc" id="L472">			}</span>


			//FIXME: ifaceBitmapsValues cannot be stored in sqlite db
			/**
			final UUID[] ifaceBitmapsKeys = new UUID[infoSession.getIfaceBitmaps().size()];
			final String[] ifaceBitmapsValues = new String[infoSession.getIfaceBitmaps().size()];
			i = 0;
			for (final Entry&lt;MetaClassID, byte[]&gt; entry : infoSession.getIfaceBitmaps().entrySet()) {
				ifaceBitmapsKeys[i] = entry.getKey().getId();
				ifaceBitmapsValues[i] = Utils.bytesToHex(entry.getValue());
				i++;
			}**/

<span class="fc" id="L486">			Connection conn = null;</span>
			try {
<span class="fc" id="L488">				conn = dataSource.getConnection();</span>
<span class="fc" id="L489">				final PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_SESSIONINFO.getSqlStatement());</span>
<span class="fc" id="L490">				insertStatement.setObject(1, infoSession.getDataClayID().getId());</span>

				// CHECKSTYLE:OFF
<span class="fc" id="L493">				insertStatement.setObject(2, infoSession.getAccountID().getId());</span>
<span class="fc" id="L494">				Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, propKeys);</span>
<span class="fc" id="L495">				insertStatement.setArray(3, tArray);</span>
<span class="fc" id="L496">				tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, propValues);</span>
<span class="fc" id="L497">				insertStatement.setArray(4, tArray);</span>
<span class="fc" id="L498">				tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessContractKeys);</span>
<span class="fc" id="L499">				insertStatement.setArray(5, tArray);</span>
<span class="fc" id="L500">				tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessContractValues);</span>
<span class="fc" id="L501">				insertStatement.setArray(6, tArray);</span>
<span class="fc" id="L502">				tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessDataContractKeys);</span>
<span class="fc" id="L503">				insertStatement.setArray(7, tArray);</span>
<span class="fc" id="L504">				tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, sessDataContractValues);</span>
<span class="fc" id="L505">				insertStatement.setArray(8, tArray);</span>

<span class="fc" id="L507">				insertStatement.setObject(9, infoSession.getDataContractIDofStore().getId());</span>
<span class="fc" id="L508">				insertStatement.setString(10, infoSession.getLanguage().name());</span>

				//tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, ifaceBitmapsKeys);
				//insertStatement.setArray(11, tArray);
				//tArray = insertStatement.getConnection().createArrayOf(&quot;varchar&quot;, ifaceBitmapsValues);
				//insertStatement.setArray(12, tArray);

<span class="fc" id="L515">				insertStatement.setDate(13, new java.sql.Date(infoSession.getEndDate().getTimeInMillis()));</span>

				// CHECKSTYLE:ON
<span class="pc bpc" id="L518" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L519">					logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
				}
<span class="fc" id="L521">				insertStatement.executeUpdate();</span>
<span class="fc" id="L522">				insertStatement.close();</span>

<span class="nc" id="L524">			} catch (final Exception e) {</span>
<span class="nc" id="L525">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L528" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L529">						conn.close();</span>
					}
<span class="nc" id="L531">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L532">					ex1.printStackTrace();</span>
<span class="fc" id="L533">				}</span>
			}
<span class="fc" id="L535">		}</span>

<span class="fc" id="L537">	}</span>

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionProperty
	 */
	private SessionProperty deserializeSessionProperty(
			final ResultSet rs) {
<span class="nc" id="L547">		SessionProperty session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="nc" id="L550">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="nc" id="L551">			final PropertyID propertyID = new PropertyID((UUID)rs.getObject(&quot;propertyID&quot;));</span>

<span class="nc" id="L553">			session = new SessionProperty();</span>
<span class="nc" id="L554">			session.setId(uuid);</span>
<span class="nc" id="L555">			session.setPropertyID(propertyID);</span>

<span class="nc" id="L557">		} catch (final SQLException e) {</span>
<span class="nc" id="L558">			e.printStackTrace();</span>
<span class="nc" id="L559">		}</span>
<span class="nc" id="L560">		return session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionImplementation
	 */
	private SessionImplementation deserializeSessionImplementation(
			final ResultSet rs) {
<span class="nc" id="L571">		SessionImplementation Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="nc" id="L574">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="nc" id="L575">			final ImplementationID implementationID = new ImplementationID((UUID)rs.getObject(&quot;implementationID&quot;));</span>
<span class="nc" id="L576">			final AccountID respAccountID = new AccountID((UUID)rs.getObject(&quot;respAccountID&quot;));</span>
<span class="nc" id="L577">			final NamespaceID namespaceID = new NamespaceID((UUID)rs.getObject(&quot;namespaceID&quot;));</span>

<span class="nc" id="L579">			Session = new SessionImplementation();</span>
<span class="nc" id="L580">			Session.setId(uuid);</span>
<span class="nc" id="L581">			Session.setRespAccountID(respAccountID);</span>
<span class="nc" id="L582">			Session.setNamespaceID(namespaceID);</span>
<span class="nc" id="L583">			Session.setImplementationID(implementationID);</span>

<span class="nc" id="L585">		} catch (final SQLException e) {</span>
<span class="nc" id="L586">			e.printStackTrace();</span>
<span class="nc" id="L587">		}</span>
<span class="nc" id="L588">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionOperation
	 */
	private SessionOperation deserializeSessionOperation(
			final ResultSet rs) {
<span class="fc" id="L599">		SessionOperation Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L602">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L603">			final OperationID operationID = new OperationID((UUID)rs.getObject(&quot;operationID&quot;));</span>
<span class="fc" id="L604">			final SessionImplementation sessionLocalImplementation = this.getSessionImplementationByID((UUID)rs.getObject(&quot;sessionLocalImplementation&quot;));</span>
<span class="fc" id="L605">			final SessionImplementation sessionRemoteImplementation = this.getSessionImplementationByID((UUID)rs.getObject(&quot;sessionRemoteImplementation&quot;));</span>

<span class="fc" id="L607">			Session = new SessionOperation();</span>
<span class="fc" id="L608">			Session.setId(uuid);</span>
<span class="fc" id="L609">			Session.setOperationID(operationID);</span>
<span class="fc" id="L610">			Session.setSessionLocalImplementation(sessionLocalImplementation);</span>
<span class="fc" id="L611">			Session.setSessionRemoteImplementation(sessionRemoteImplementation);</span>

<span class="nc" id="L613">		} catch (final SQLException e) {</span>
<span class="nc" id="L614">			e.printStackTrace();</span>
<span class="fc" id="L615">		}</span>
<span class="fc" id="L616">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionContract
	 */
	private SessionContract deserializeSessionContract(
			final ResultSet rs) {
<span class="fc" id="L627">		SessionContract Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L630">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L631">			final ContractID contractID = new ContractID((UUID)rs.getObject(&quot;contractID&quot;));</span>

<span class="fc" id="L633">			final Map&lt;InterfaceID, SessionInterface&gt; sessionInterfaces = new HashMap&lt;&gt;();</span>
<span class="fc" id="L634">			final UUID[] uuids = (UUID[]) rs.getArray(&quot;sessionInterfaces&quot;).getArray();</span>
<span class="fc bfc" id="L635" title="All 2 branches covered.">			for (final UUID curUUID : uuids) {</span>
<span class="fc" id="L636">				final SessionInterface sessIface = this.getSessionInterfaceByID(curUUID);</span>
<span class="fc" id="L637">				final InterfaceID ifaceID = sessIface.getInterfaceID();</span>
<span class="fc" id="L638">				sessionInterfaces.put(ifaceID, sessIface);</span>
			}

<span class="fc" id="L641">			Session = new SessionContract();</span>
<span class="fc" id="L642">			Session.setId(uuid);</span>
<span class="fc" id="L643">			Session.setContractID(contractID);</span>
<span class="fc" id="L644">			Session.setSessionInterfaces(sessionInterfaces);</span>

<span class="nc" id="L646">		} catch (final SQLException e) {</span>
<span class="nc" id="L647">			e.printStackTrace();</span>
<span class="fc" id="L648">		}</span>
<span class="fc" id="L649">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionInterface
	 */
	private SessionInterface deserializeSessionInterface(
			final ResultSet rs) {
<span class="fc" id="L660">		SessionInterface iface = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L663">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L664">			final InterfaceID interfaceID = new InterfaceID((UUID)rs.getObject(&quot;interfaceID&quot;));</span>
<span class="fc" id="L665">			final MetaClassID classOfInterface = new MetaClassID((UUID)rs.getObject(&quot;classOfInterface&quot;));</span>
<span class="fc" id="L666">			final InterfaceID importOfInterface = new InterfaceID((UUID)rs.getObject(&quot;importOfInterface&quot;));</span>

<span class="fc" id="L668">			final Map&lt;PropertyID, SessionProperty&gt; sessionProperties = new HashMap&lt;&gt;();</span>
<span class="fc" id="L669">			final Map&lt;OperationID, SessionOperation&gt; sessionOperations = new HashMap&lt;&gt;();</span>

<span class="fc" id="L671">			Array array = rs.getArray(&quot;sessionOperations&quot;);</span>
<span class="pc bpc" id="L672" title="1 of 2 branches missed.">			if (array != null) {</span>
<span class="fc" id="L673">				final UUID[] opsUUIDs = (UUID[]) array.getArray();</span>
<span class="fc bfc" id="L674" title="All 2 branches covered.">				for (final UUID opUUID : opsUUIDs) {</span>
<span class="fc" id="L675">					final SessionOperation op = this.getSessionOperationByID(opUUID);</span>
<span class="fc" id="L676">					final OperationID opID = op.getOperationID();</span>
<span class="fc" id="L677">					sessionOperations.put(opID, op);</span>
				}
			}

<span class="fc" id="L681">			array = rs.getArray(&quot;sessionProperties&quot;);</span>
<span class="pc bpc" id="L682" title="1 of 2 branches missed.">			if (array != null) {</span>
<span class="nc" id="L683">				final UUID[] propsUUIDs = (UUID[]) array.getArray();</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">				for (final UUID propUUID : propsUUIDs) {</span>
<span class="nc" id="L685">					final SessionProperty prop = this.getSessionPropertyByID(propUUID);</span>
<span class="nc" id="L686">					final PropertyID propID = prop.getPropertyID();</span>
<span class="nc" id="L687">					sessionProperties.put(propID, prop);</span>
				}
			}

<span class="fc" id="L691">			iface = new SessionInterface();</span>
<span class="fc" id="L692">			iface.setClassOfInterface(classOfInterface);</span>
<span class="fc" id="L693">			iface.setId(uuid);</span>
<span class="fc" id="L694">			iface.setImportOfInterface(importOfInterface);</span>
<span class="fc" id="L695">			iface.setInterfaceID(interfaceID);</span>
<span class="fc" id="L696">			iface.setSessionOperations(sessionOperations);</span>
<span class="fc" id="L697">			iface.setSessionProperties(sessionProperties);</span>

<span class="nc" id="L699">		} catch (final SQLException e) {</span>
<span class="nc" id="L700">			e.printStackTrace();</span>
<span class="fc" id="L701">		}</span>
<span class="fc" id="L702">		return iface;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionContract
	 */
	private SessionDataContract deserializeSessionDataContract(
			final ResultSet rs) {
<span class="fc" id="L713">		SessionDataContract Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L716">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L717">			final DataContractID datacontractID = new DataContractID((UUID)rs.getObject(&quot;datacontractID&quot;));</span>
<span class="fc" id="L718">			final DataSetID datasetOfProvider = new DataSetID((UUID)rs.getObject(&quot;datasetOfProvider&quot;));</span>

<span class="fc" id="L720">			Session = new SessionDataContract();</span>
<span class="fc" id="L721">			Session.setId(uuid);</span>
<span class="fc" id="L722">			Session.setDataContractID(datacontractID);</span>
<span class="fc" id="L723">			Session.setDataSetOfProvider(datasetOfProvider);</span>

<span class="nc" id="L725">		} catch (final SQLException e) {</span>
<span class="nc" id="L726">			e.printStackTrace();</span>
<span class="fc" id="L727">		}</span>
<span class="fc" id="L728">		return Session;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return SessionContract
	 */
	private Session deserializeSession(
			final ResultSet rs) {
<span class="fc" id="L739">		Session Session = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L742">			final SessionID sessionID = new SessionID((UUID)rs.getObject(&quot;id&quot;));</span>
<span class="fc" id="L743">			final AccountID accountID = new AccountID((UUID)rs.getObject(&quot;accountID&quot;));</span>

<span class="fc" id="L745">			final UUID[] propertiesOfClassesKeys = (UUID[]) rs.getArray(&quot;propertiesOfClassesKeys&quot;).getArray();</span>
<span class="fc" id="L746">			final UUID[] propertiesOfClassesValues = (UUID[]) rs.getArray(&quot;propertiesOfClassesValues&quot;).getArray();</span>
<span class="fc" id="L747">			final Map&lt;MetaClassID, Set&lt;PropertyID&gt;&gt; propertiesOfClasses = new HashMap&lt;&gt;();</span>
<span class="pc bpc" id="L748" title="1 of 2 branches missed.">			for (int i = 0; i &lt; propertiesOfClassesKeys.length; ++i) {</span>
<span class="nc" id="L749">				final MetaClassID classID = new MetaClassID(propertiesOfClassesKeys[i]);</span>
<span class="nc" id="L750">				Set&lt;PropertyID&gt; propIDs = propertiesOfClasses.get(classID);</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">				if (propIDs == null) {</span>
<span class="nc" id="L752">					propIDs = new HashSet&lt;&gt;();</span>
<span class="nc" id="L753">					propertiesOfClasses.put(classID, propIDs);</span>
				}
<span class="nc" id="L755">				final PropertyID propID = new PropertyID(propertiesOfClassesValues[i]);</span>
<span class="nc" id="L756">				propIDs.add(propID);</span>
			}

<span class="fc" id="L759">			final UUID[] sessionContractsKeys = (UUID[]) rs.getArray(&quot;sessionContractsKeys&quot;).getArray();</span>
<span class="fc" id="L760">			final UUID[] sessionContractsValues = (UUID[]) rs.getArray(&quot;sessionContractsValues&quot;).getArray();</span>
<span class="fc" id="L761">			final Map&lt;ContractID, SessionContract&gt; sessionContracts = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L762" title="All 2 branches covered.">			for (int i = 0; i &lt; sessionContractsKeys.length; ++i) {</span>
<span class="fc" id="L763">				final ContractID contractID = new ContractID(sessionContractsKeys[i]);</span>
<span class="fc" id="L764">				final SessionContract sessionContract = this.getSessionContractByID(sessionContractsValues[i]);</span>
<span class="fc" id="L765">				sessionContracts.put(contractID, sessionContract);</span>
			}

<span class="fc" id="L768">			final UUID[] sessionDataContractsKeys = (UUID[]) rs.getArray(&quot;sessionDataContractsKeys&quot;).getArray();</span>
<span class="fc" id="L769">			final UUID[] sessionDataContractsValues = (UUID[]) rs.getArray(&quot;sessionDataContractsValues&quot;).getArray();</span>
<span class="fc" id="L770">			final Map&lt;DataContractID, SessionDataContract&gt; sessionDataContracts = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L771" title="All 2 branches covered.">			for (int i = 0; i &lt; sessionDataContractsKeys.length; ++i) {</span>
<span class="fc" id="L772">				final DataContractID datacontractID = new DataContractID(sessionDataContractsKeys[i]);</span>
<span class="fc" id="L773">				final SessionDataContract sessionDataContract = this.getSessionDataContractByID(sessionDataContractsValues[i]);</span>
<span class="fc" id="L774">				sessionDataContracts.put(datacontractID, sessionDataContract);</span>
			}

			//FIXME: ifaceBitMaps cannot be stored in DB
			/**
			final Map&lt;MetaClassID, byte[]&gt; ifaceBitmaps = new HashMap&lt;&gt;();
			final UUID[] ifaceBitmapsKeys = (UUID[]) rs.getArray(&quot;ifaceBitmapsKeys&quot;).getArray();
			final String[] subRs = (String[]) rs.getArray(&quot;ifaceBitmapsValues&quot;).getArray();
			for (int i = 0; i &lt; ifaceBitmapsKeys.length; ++i) {
				final MetaClassID classID = new MetaClassID(ifaceBitmapsKeys[i]);
				final byte[] values = Utils.hexStringToByteArray(subRs[i]);
				ifaceBitmaps.put(classID, values);
			}**/

<span class="fc" id="L788">			final DataContractID dataContractIDforStore = new DataContractID((UUID)rs.getObject(&quot;dataContractIDforStore&quot;));</span>
<span class="fc" id="L789">			final Langs language = Langs.valueOf(rs.getString(&quot;language&quot;));</span>
<span class="fc" id="L790">			final Calendar endDate = Calendar.getInstance();</span>
<span class="fc" id="L791">			endDate.setTime(rs.getDate(&quot;endDate&quot;));</span>

<span class="fc" id="L793">			Session = new Session();</span>
<span class="fc" id="L794">			Session.setAccountID(accountID);</span>
<span class="fc" id="L795">			Session.setDataContractIDofStore(dataContractIDforStore);</span>
<span class="fc" id="L796">			Session.setEndDate(endDate);</span>
			//Session.setIfaceBitmaps(ifaceBitmaps);
<span class="fc" id="L798">			Session.setLanguage(language);</span>
<span class="fc" id="L799">			Session.setPropertiesOfClasses(propertiesOfClasses);</span>
<span class="fc" id="L800">			Session.setSessionContracts(sessionContracts);</span>
<span class="fc" id="L801">			Session.setSessionDataContracts(sessionDataContracts);</span>
<span class="fc" id="L802">			Session.setDataClayID(sessionID);</span>

<span class="nc" id="L804">		} catch (final SQLException e) {</span>
<span class="nc" id="L805">			e.printStackTrace();</span>
<span class="fc" id="L806">		}</span>
<span class="fc" id="L807">		return Session;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionProperty getSessionPropertyByID(final UUID uuid) throws SQLException {
<span class="nc" id="L819">		ResultSet rs = null;</span>
<span class="nc" id="L820">		SessionProperty info = null;</span>
<span class="nc" id="L821">		Connection conn = null;</span>
		try {
<span class="nc" id="L823">			conn = dataSource.getConnection();</span>
<span class="nc" id="L824">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONPROPERTY.getSqlStatement());</span>

<span class="nc" id="L826">			selectStatement.setObject(1, uuid);</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L828">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="nc" id="L830">			rs = selectStatement.executeQuery();</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L832">				info = deserializeSessionProperty(rs);</span>
			}
<span class="nc" id="L834">			selectStatement.close();</span>

<span class="nc" id="L836">		} catch (final SQLException e) {</span>
<span class="nc" id="L837">			throw e;</span>
		} finally {
			try {
<span class="nc bnc" id="L840" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L841">					conn.close();</span>
				}
<span class="nc" id="L843">			} catch (final SQLException e) {</span>
<span class="nc" id="L844">				e.printStackTrace();</span>
<span class="nc" id="L845">			}</span>
		}

<span class="nc" id="L848">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionImplementation getSessionImplementationByID(final UUID uuid) throws SQLException {
<span class="fc" id="L860">		ResultSet rs = null;</span>
<span class="fc" id="L861">		SessionImplementation info = null;</span>
<span class="fc" id="L862">		Connection conn = null;</span>
		try {
<span class="fc" id="L864">			conn = dataSource.getConnection();</span>
<span class="fc" id="L865">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONIMPLEMENTATION.getSqlStatement());</span>

<span class="fc" id="L867">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L868" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L869">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L871">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L872" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L873">				info = deserializeSessionImplementation(rs);</span>
			}
<span class="fc" id="L875">			selectStatement.close();</span>

<span class="nc" id="L877">		} catch (final SQLException e) {</span>
<span class="nc" id="L878">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L881" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L882">					conn.close();</span>
				}
<span class="nc" id="L884">			} catch (final SQLException e) {</span>
<span class="nc" id="L885">				e.printStackTrace();</span>
<span class="fc" id="L886">			}</span>
		}

<span class="fc" id="L889">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionOperation getSessionOperationByID(final UUID uuid) throws SQLException {
<span class="fc" id="L901">		ResultSet rs = null;</span>
<span class="fc" id="L902">		SessionOperation info = null;</span>
<span class="fc" id="L903">		Connection conn = null;</span>
		try {
<span class="fc" id="L905">			conn = dataSource.getConnection();</span>
<span class="fc" id="L906">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONOPERATION.getSqlStatement());</span>

<span class="fc" id="L908">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L909" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L910">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L912">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L913" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L914">				info = deserializeSessionOperation(rs);</span>
			}
<span class="fc" id="L916">			selectStatement.close();</span>

<span class="nc" id="L918">		} catch (final SQLException e) {</span>
<span class="nc" id="L919">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L922" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L923">					conn.close();</span>
				}
<span class="nc" id="L925">			} catch (final SQLException e) {</span>
<span class="nc" id="L926">				e.printStackTrace();</span>
<span class="fc" id="L927">			}</span>
		}

<span class="fc" id="L930">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionInterface getSessionInterfaceByID(final UUID uuid) throws SQLException {
<span class="fc" id="L942">		ResultSet rs = null;</span>
<span class="fc" id="L943">		SessionInterface info = null;</span>
<span class="fc" id="L944">		Connection conn = null;</span>
		try {
<span class="fc" id="L946">			conn = dataSource.getConnection();</span>
<span class="fc" id="L947">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONINTERFACE.getSqlStatement());</span>

<span class="fc" id="L949">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L950" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L951">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L953">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L954" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L955">				info = deserializeSessionInterface(rs);</span>
			}
<span class="fc" id="L957">			selectStatement.close();</span>

<span class="nc" id="L959">		} catch (final SQLException e) {</span>
<span class="nc" id="L960">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L963" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L964">					conn.close();</span>
				}
<span class="nc" id="L966">			} catch (final SQLException e) {</span>
<span class="nc" id="L967">				e.printStackTrace();</span>
<span class="fc" id="L968">			}</span>
		}

<span class="fc" id="L971">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionContract getSessionContractByID(final UUID uuid) throws SQLException {
<span class="fc" id="L983">		ResultSet rs = null;</span>
<span class="fc" id="L984">		SessionContract info = null;</span>
<span class="fc" id="L985">		Connection conn = null;</span>
		try {
<span class="fc" id="L987">			conn = dataSource.getConnection();</span>
<span class="fc" id="L988">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONCONTRACT.getSqlStatement());</span>

<span class="fc" id="L990">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L991" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L992">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L994">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L995" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L996">				info = deserializeSessionContract(rs);</span>
			}
<span class="fc" id="L998">			selectStatement.close();</span>

<span class="nc" id="L1000">		} catch (final SQLException e) {</span>
<span class="nc" id="L1001">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L1004" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L1005">					conn.close();</span>
				}
<span class="nc" id="L1007">			} catch (final SQLException e) {</span>
<span class="nc" id="L1008">				e.printStackTrace();</span>
<span class="fc" id="L1009">			}</span>
		}

<span class="fc" id="L1012">		return info;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID
	 * @return The info
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private SessionDataContract getSessionDataContractByID(final UUID uuid) throws SQLException {
<span class="fc" id="L1024">		ResultSet rs = null;</span>
<span class="fc" id="L1025">		SessionDataContract info = null;</span>
<span class="fc" id="L1026">		Connection conn = null;</span>
		try {
<span class="fc" id="L1028">			conn = dataSource.getConnection();</span>
<span class="fc" id="L1029">			final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONDATACONTRACT.getSqlStatement());</span>

<span class="fc" id="L1031">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L1032" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1033">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L1035">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L1036" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L1037">				info = deserializeSessionDataContract(rs);</span>
			}
<span class="fc" id="L1039">			selectStatement.close();</span>

<span class="nc" id="L1041">		} catch (final SQLException e) {</span>
<span class="nc" id="L1042">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L1045" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L1046">					conn.close();</span>
				}
<span class="nc" id="L1048">			} catch (final SQLException e) {</span>
<span class="nc" id="L1049">				e.printStackTrace();</span>
<span class="fc" id="L1050">			}</span>
		}

<span class="fc" id="L1053">		return info;</span>
	}

	/**
	 * Get session info by ID
	 * @param sessionID
	 *            ID of the session
	 * @return The info of the session. Null if it is not registered.
	 */
	public Session getSessionByID(final SessionID sessionID) {
<span class="fc" id="L1063">		synchronized (dataSource) {</span>

<span class="fc" id="L1065">			ResultSet rs = null;</span>
<span class="fc" id="L1066">			Session info = null;</span>
<span class="fc" id="L1067">			Connection conn = null;</span>
			try {
<span class="fc" id="L1069">				conn = dataSource.getConnection();</span>
<span class="fc" id="L1070">				final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONINFO.getSqlStatement());</span>

<span class="fc" id="L1072">				selectStatement.setObject(1, sessionID.getId());</span>
<span class="pc bpc" id="L1073" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1074">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="fc" id="L1076">				rs = selectStatement.executeQuery();</span>
<span class="fc bfc" id="L1077" title="All 2 branches covered.">				if (rs.next()) {</span>
<span class="fc" id="L1078">					info = deserializeSession(rs);</span>
				}
<span class="fc" id="L1080">				selectStatement.close();</span>

<span class="nc" id="L1082">			} catch (final SQLException e) {</span>
<span class="nc" id="L1083">				return null;</span>
			} finally {
				try {
<span class="pc bpc" id="L1086" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L1087">						conn.close();</span>
					}
<span class="nc" id="L1089">				} catch (final SQLException e) {</span>
<span class="nc" id="L1090">					e.printStackTrace();</span>
<span class="pc" id="L1091">				}</span>
			}

<span class="fc" id="L1094">			return info;</span>
		}
	}

	/**
	 * Get Sessions of account
	 * @param accountID
	 *            AccountID ID
	 * @return The Sessions
	 */
	public List&lt;Session&gt; getSessionsOfAccount(final AccountID accountID) {
<span class="nc" id="L1105">		synchronized (dataSource) {</span>

<span class="nc" id="L1107">			ResultSet rs = null;</span>
<span class="nc" id="L1108">			final List&lt;Session&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1109">			Connection conn = null;</span>
			try {
<span class="nc" id="L1111">				conn = dataSource.getConnection();</span>
<span class="nc" id="L1112">				final PreparedStatement selectStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_SESSIONS_OF_ACCOUNT.getSqlStatement());</span>

<span class="nc" id="L1114">				selectStatement.setObject(1, accountID.getId());</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1116">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="nc" id="L1118">				rs = selectStatement.executeQuery();</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1120">					result.add(deserializeSession(rs));</span>
				}
<span class="nc" id="L1122">				selectStatement.close();</span>

<span class="nc" id="L1124">			} catch (final SQLException e) {</span>
<span class="nc" id="L1125">				e.printStackTrace();</span>
			} finally {
				try {
<span class="nc bnc" id="L1128" title="All 2 branches missed.">					if (conn != null) {</span>
<span class="nc" id="L1129">						conn.close();</span>
					}
<span class="nc" id="L1131">				} catch (final SQLException e) {</span>
<span class="nc" id="L1132">					e.printStackTrace();</span>
<span class="nc" id="L1133">				}</span>
			}

<span class="nc" id="L1136">			return result;</span>
		}
	}

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 */
	private void deleteSessionDataContract(final UUID uuid) {

<span class="nc" id="L1147">		Connection conn = null;</span>
		try {
<span class="nc" id="L1149">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1150">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONDATACONTRACT.getSqlStatement());</span>
<span class="nc" id="L1151">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1153" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1154">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1156">			stmt.executeUpdate();</span>
<span class="nc" id="L1157">			stmt.close();</span>

<span class="nc" id="L1159">		} catch (final Exception e) {</span>
<span class="nc" id="L1160">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1163" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1164">					conn.close();</span>
				}
<span class="nc" id="L1166">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1167">				ex1.printStackTrace();</span>
<span class="nc" id="L1168">			}</span>
		}
<span class="nc" id="L1170">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 */
	private void deleteSessionImplementation(final UUID uuid) {

<span class="nc" id="L1179">		Connection conn = null;</span>
		try {
<span class="nc" id="L1181">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1182">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONIMPLEMENTATION.getSqlStatement());</span>
<span class="nc" id="L1183">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1185" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1186">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1188">			stmt.executeUpdate();</span>
<span class="nc" id="L1189">			stmt.close();</span>

<span class="nc" id="L1191">		} catch (final Exception e) {</span>
<span class="nc" id="L1192">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1195" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1196">					conn.close();</span>
				}
<span class="nc" id="L1198">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1199">				ex1.printStackTrace();</span>
<span class="nc" id="L1200">			}</span>
		}
<span class="nc" id="L1202">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private void deleteSessionOperation(final UUID uuid) throws SQLException {

<span class="nc" id="L1213">		final SessionOperation sessOperation = this.getSessionOperationByID(uuid);</span>
<span class="nc" id="L1214">		this.deleteSessionImplementation(sessOperation.getSessionLocalImplementation().getId());</span>
<span class="nc" id="L1215">		this.deleteSessionImplementation(sessOperation.getSessionRemoteImplementation().getId());</span>

<span class="nc" id="L1217">		Connection conn = null;</span>
		try {
<span class="nc" id="L1219">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1220">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONOPERATION.getSqlStatement());</span>
<span class="nc" id="L1221">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1223" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1224">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1226">			stmt.executeUpdate();</span>
<span class="nc" id="L1227">			stmt.close();</span>

<span class="nc" id="L1229">		} catch (final Exception e) {</span>
<span class="nc" id="L1230">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1233" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1234">					conn.close();</span>
				}
<span class="nc" id="L1236">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1237">				ex1.printStackTrace();</span>
<span class="nc" id="L1238">			}</span>
		}
<span class="nc" id="L1240">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 */
	private void deleteSessionProperty(final UUID uuid) {

<span class="nc" id="L1249">		Connection conn = null;</span>
		try {
<span class="nc" id="L1251">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1252">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONPROPERTY.getSqlStatement());</span>
<span class="nc" id="L1253">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1255" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1256">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1258">			stmt.executeUpdate();</span>
<span class="nc" id="L1259">			stmt.close();</span>

<span class="nc" id="L1261">		} catch (final Exception e) {</span>
<span class="nc" id="L1262">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1265" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1266">					conn.close();</span>
				}
<span class="nc" id="L1268">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1269">				ex1.printStackTrace();</span>
<span class="nc" id="L1270">			}</span>
		}
<span class="nc" id="L1272">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private void deleteSessionInterface(final UUID uuid) throws SQLException {

<span class="nc" id="L1283">		final SessionInterface sessIface = this.getSessionInterfaceByID(uuid);</span>
<span class="nc bnc" id="L1284" title="All 2 branches missed.">		for (final SessionOperation sessOp : sessIface.getSessionOperations().values()) {</span>
<span class="nc" id="L1285">			this.deleteSessionOperation(sessOp.getId());</span>
<span class="nc" id="L1286">		}</span>
<span class="nc bnc" id="L1287" title="All 2 branches missed.">		for (final SessionProperty sessProp : sessIface.getSessionProperties().values()) {</span>
<span class="nc" id="L1288">			this.deleteSessionProperty(sessProp.getId());</span>
<span class="nc" id="L1289">		}</span>

<span class="nc" id="L1291">		Connection conn = null;</span>
		try {
<span class="nc" id="L1293">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1294">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONINTERFACE.getSqlStatement());</span>
<span class="nc" id="L1295">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1297" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1298">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1300">			stmt.executeUpdate();</span>
<span class="nc" id="L1301">			stmt.close();</span>

<span class="nc" id="L1303">		} catch (final Exception e) {</span>
<span class="nc" id="L1304">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1307" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1308">					conn.close();</span>
				}
<span class="nc" id="L1310">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1311">				ex1.printStackTrace();</span>
<span class="nc" id="L1312">			}</span>
		}
<span class="nc" id="L1314">	}</span>

	/**
	 * Delete
	 * @param uuid
	 *            UUID of object to delete
	 * @throws SQLException
	 *             if some exception occurs
	 */
	private void deleteSessionContract(final UUID uuid) throws SQLException {

<span class="nc" id="L1325">		final SessionContract sessContract = this.getSessionContractByID(uuid);</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">		for (final SessionInterface sessIface : sessContract.getSessionInterfaces().values()) {</span>
<span class="nc" id="L1327">			this.deleteSessionInterface(sessIface.getId());</span>
<span class="nc" id="L1328">		}</span>

<span class="nc" id="L1330">		Connection conn = null;</span>
		try {
<span class="nc" id="L1332">			conn = dataSource.getConnection();</span>
<span class="nc" id="L1333">			final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONCONTRACT.getSqlStatement());</span>
<span class="nc" id="L1334">			stmt.setObject(1, uuid);</span>
			// CHECKSTYLE:ON
<span class="nc bnc" id="L1336" title="All 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1337">				logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
			}
<span class="nc" id="L1339">			stmt.executeUpdate();</span>
<span class="nc" id="L1340">			stmt.close();</span>

<span class="nc" id="L1342">		} catch (final Exception e) {</span>
<span class="nc" id="L1343">			e.printStackTrace();</span>
		} finally {
			try {
<span class="nc bnc" id="L1346" title="All 2 branches missed.">				if (conn != null) {</span>
<span class="nc" id="L1347">					conn.close();</span>
				}
<span class="nc" id="L1349">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L1350">				ex1.printStackTrace();</span>
<span class="nc" id="L1351">			}</span>
		}
<span class="nc" id="L1353">	}</span>

	/**
	 * Delete accessedImplementation
	 * @param sessionID
	 *            ID of object to delete
	 */
	public void deleteSession(final SessionID sessionID) {
<span class="nc" id="L1361">		synchronized (dataSource) {</span>

<span class="nc" id="L1363">			Connection conn = null;</span>
			try {

<span class="nc" id="L1366">				final Session sessInfo = this.getSessionByID(sessionID);</span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">				for (final SessionContract sessContract : sessInfo.getSessionContracts().values()) {</span>
<span class="nc" id="L1368">					this.deleteSessionContract(sessContract.getId());</span>
<span class="nc" id="L1369">				}</span>
<span class="nc bnc" id="L1370" title="All 2 branches missed.">				for (final SessionDataContract sessDataContract : sessInfo.getSessionDataContracts().values()) {</span>
<span class="nc" id="L1371">					this.deleteSessionDataContract(sessDataContract.getId());</span>
<span class="nc" id="L1372">				}</span>

<span class="nc" id="L1374">				conn = dataSource.getConnection();</span>
<span class="nc" id="L1375">				final PreparedStatement stmt = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_SESSIONINFO.getSqlStatement());</span>
<span class="nc" id="L1376">				stmt.setObject(1, sessionID.getId());</span>
				// CHECKSTYLE:ON
<span class="nc bnc" id="L1378" title="All 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1379">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="nc" id="L1381">				stmt.executeUpdate();</span>
<span class="nc" id="L1382">				stmt.close();</span>

<span class="nc" id="L1384">			} catch (final Exception e) {</span>
<span class="nc" id="L1385">				e.printStackTrace();</span>
			} finally {
				try {
<span class="nc bnc" id="L1388" title="All 2 branches missed.">					if (conn != null) {</span>
<span class="nc" id="L1389">						conn.close();</span>
					}
<span class="nc" id="L1391">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L1392">					ex1.printStackTrace();</span>
<span class="nc" id="L1393">				}</span>
			}
<span class="nc" id="L1395">		}</span>
<span class="nc" id="L1396">	}</span>

	/**
	 * Close DB.
	 */
	public void close() {
		try {
<span class="fc" id="L1403">			dataSource.close();</span>
<span class="nc" id="L1404">		}catch(Exception e) {</span>
			// TODO
<span class="nc" id="L1406">			e.printStackTrace();</span>
<span class="fc" id="L1407">		}</span>
<span class="fc" id="L1408">	}</span>

	/**
	 * Check if session exists
	 * @param sessionID
	 *            session iD
	 * @return TRUE if exists.
	 */
	public boolean existsObjectByID(final SessionID sessionID) {
<span class="fc" id="L1417">		synchronized (dataSource) {</span>
<span class="pc bpc" id="L1418" title="1 of 2 branches missed.">			return this.getSessionByID(sessionID) != null;</span>
		}
	}

	/**
	 * Store external session.
	 * @param infoSession
	 *            info of the external session to be stored
	 */
	public void storeExt(final Session infoSession) {
<span class="nc" id="L1428">		synchronized (dataSource) {</span>

<span class="nc" id="L1430">			try (Connection conn = dataSource.getConnection()) {</span>
<span class="nc" id="L1431">				try (PreparedStatement insertStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.INSERT_EXT_SESSION.getSqlStatement())) {</span>
<span class="nc" id="L1432">					insertStatement.setObject(1, infoSession.getExtDataClayID().getId());</span>
<span class="nc" id="L1433">					insertStatement.setObject(2, infoSession.getDataClayID().getId());</span>
<span class="nc" id="L1434">					insertStatement.setObject(3, infoSession.getAccountID().getId());</span>
<span class="nc" id="L1435">					insertStatement.setString(4, infoSession.getLanguage().name());</span>
<span class="nc" id="L1436">					insertStatement.setDate(5, new java.sql.Date(infoSession.getEndDate().getTimeInMillis()));</span>
<span class="nc" id="L1437">					insertStatement.executeUpdate();</span>
				}
<span class="nc" id="L1439">			} catch (final Exception e) {</span>
				// Ignore
<span class="nc" id="L1441">			}</span>
<span class="nc" id="L1442">		}</span>
<span class="nc" id="L1443">	}</span>

	/**
	 * Get info about an external session
	 * @param extDataClayID
	 *            id of the external dataClay instance
	 * @return session info. null if there is no session for the given dataClay instance.
	 */
	public Session getExtSession(final DataClayInstanceID extDataClayID) {
<span class="nc" id="L1452">		synchronized (dataSource) {</span>

<span class="nc" id="L1454">			try (Connection conn = dataSource.getConnection()) {</span>
<span class="nc" id="L1455">				try (PreparedStatement queryStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.SELECT_EXT_SESSION.getSqlStatement())) {</span>
<span class="nc" id="L1456">					try (ResultSet rs = queryStatement.executeQuery()) {</span>
<span class="nc" id="L1457">						final SessionID sessionID = new SessionID((UUID) rs.getObject(&quot;sessionID&quot;));</span>
<span class="nc" id="L1458">						final AccountID accountID = new AccountID((UUID) rs.getObject(&quot;accountID&quot;));</span>
<span class="nc" id="L1459">						final Langs language = Langs.valueOf(rs.getString(&quot;language&quot;));</span>
<span class="nc" id="L1460">						final Calendar endDate = Calendar.getInstance();</span>
<span class="nc" id="L1461">						endDate.setTime(rs.getDate(&quot;endDate&quot;));</span>
<span class="nc" id="L1462">						final Session result = new Session();</span>
<span class="nc" id="L1463">						result.setDataClayID(sessionID);</span>
<span class="nc" id="L1464">						result.setAccountID(accountID);</span>
<span class="nc" id="L1465">						result.setExtDataClayID(extDataClayID);</span>
<span class="nc" id="L1466">						result.setLanguage(language);</span>
<span class="nc" id="L1467">						result.setEndDate(endDate);</span>
<span class="nc" id="L1468">						return result;</span>
					}
				}
<span class="nc" id="L1471">			} catch (final Exception e) {</span>
<span class="nc" id="L1472">				return null;</span>
			}
		}
	}

	public void deleteExtSession(final DataClayInstanceID dataClayID) {
<span class="nc" id="L1478">		synchronized (dataSource) {</span>

<span class="nc" id="L1480">			try (Connection conn = dataSource.getConnection()) {</span>
<span class="nc" id="L1481">				try (PreparedStatement deleteStatement = conn.prepareStatement(SessionManagerSQLStatements.SqlStatements.DELETE_EXT_SESSION.getSqlStatement())) {</span>
<span class="nc" id="L1482">					deleteStatement.setObject(1, dataClayID.getId());</span>
<span class="nc" id="L1483">					deleteStatement.executeUpdate();</span>
				}
<span class="nc" id="L1485">			} catch (final Exception ex) {</span>
				// ignore
<span class="nc" id="L1487">			}</span>
<span class="nc" id="L1488">		}</span>
<span class="nc" id="L1489">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>