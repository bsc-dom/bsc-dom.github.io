<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NamespaceManagerDB.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">dataclay</a> &gt; <a href="index.source.html" class="el_package">es.bsc.dataclay.logic.namespacemgr</a> &gt; <span class="el_source">NamespaceManagerDB.java</span></div><h1>NamespaceManagerDB.java</h1><pre class="source lang-java linenums">
package es.bsc.dataclay.logic.namespacemgr;

import java.sql.Array;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.UUID;

import org.apache.commons.dbcp2.BasicDataSource;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import es.bsc.dataclay.communication.grpc.messages.common.CommonMessages.Langs;
import es.bsc.dataclay.util.Configuration;
import es.bsc.dataclay.util.ids.AccountID;
import es.bsc.dataclay.util.ids.ContractID;
import es.bsc.dataclay.util.ids.ImplementationID;
import es.bsc.dataclay.util.ids.InterfaceID;
import es.bsc.dataclay.util.ids.MetaClassID;
import es.bsc.dataclay.util.ids.NamespaceID;
import es.bsc.dataclay.util.ids.OperationID;
import es.bsc.dataclay.util.ids.PropertyID;
import es.bsc.dataclay.util.management.namespacemgr.ImportedInterface;
import es.bsc.dataclay.util.management.namespacemgr.Namespace;
import es.bsc.dataclay.util.structs.Tuple;
import es.bsc.dataclay.dbhandler.sql.sqlite.SQLiteDataSource;

/**
 * Data base connection.
 */
public final class NamespaceManagerDB {

	/** Logger. */
	private Logger logger;

	/** Indicates if debug is enabled. */
<span class="fc" id="L46">	private static final boolean DEBUG_ENABLED = Configuration.isDebugEnabled();</span>

	/** SingleConnection. */
	private final SQLiteDataSource dataSource;

	/**
	 * MetaDataServiceDB constructor.
	 *
	 */
<span class="fc" id="L55">	public NamespaceManagerDB(final SQLiteDataSource dataSource) {</span>
<span class="fc" id="L56">		this.dataSource = dataSource;</span>
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">		if (DEBUG_ENABLED) {</span>
<span class="nc" id="L58">			logger = LogManager.getLogger(&quot;LMDB&quot;);</span>
		}
<span class="fc" id="L60">	}</span>

	/**
	 * Create tables of MDS.
	 */
	public void createTables() {
<span class="fc" id="L66">		synchronized (dataSource) {</span>

<span class="fc" id="L68">			Connection conn = null;</span>
			try {
<span class="fc" id="L70">				conn = dataSource.getConnection();</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">				for (final NamespaceManagerSQLStatements.SqlStatements stmt : NamespaceManagerSQLStatements.SqlStatements.values()) {</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">					if (stmt.name().startsWith(&quot;CREATE_TABLE&quot;)) {</span>
<span class="fc" id="L73">						final PreparedStatement updateStatement = conn.prepareStatement(stmt.getSqlStatement());</span>
<span class="fc" id="L74">						updateStatement.execute();</span>
<span class="fc" id="L75">						updateStatement.close();</span>
					}
				}
<span class="nc" id="L78">			} catch (final SQLException e) {</span>
<span class="nc" id="L79">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L83">						conn.close();</span>
					}
<span class="nc" id="L85">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L86">					ex1.printStackTrace();</span>
<span class="fc" id="L87">				}</span>
			}
<span class="fc" id="L89">		}</span>
<span class="fc" id="L90">	}</span>

	/**
	 * Delete the tables of MDS. Just the other way around of createTables --much simpler.
	 */
	public void dropTables() {
<span class="fc" id="L96">		synchronized (dataSource) {</span>

<span class="fc" id="L98">			Connection conn = null;</span>
			try {
<span class="fc" id="L100">				conn = dataSource.getConnection();</span>
<span class="fc bfc" id="L101" title="All 2 branches covered.">				for (final NamespaceManagerSQLStatements.SqlStatements stmt : NamespaceManagerSQLStatements.SqlStatements.values()) {</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">					if (stmt.name().startsWith(&quot;DROP_TABLE&quot;)) {</span>
<span class="fc" id="L103">						final PreparedStatement updateStatement = conn.prepareStatement(stmt.getSqlStatement());</span>
<span class="fc" id="L104">						updateStatement.execute();</span>
<span class="fc" id="L105">						updateStatement.close();</span>
					}
				}
<span class="nc" id="L108">			} catch (final SQLException e) {</span>
<span class="nc" id="L109">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L113">						conn.close();</span>
					}
<span class="nc" id="L115">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L116">					ex1.printStackTrace();</span>
<span class="fc" id="L117">				}</span>
			}
<span class="fc" id="L119">		}</span>
<span class="fc" id="L120">	}</span>

	/**
	 * Store ImportedInterface into database
	 * @param importedIface
	 *            importedIface
	 * @return UUID of stored object
	 */
	private UUID store(final ImportedInterface importedIface) {

<span class="fc" id="L130">		final UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L131">		importedIface.setId(uuid);</span>

<span class="fc" id="L133">		Connection conn = null;</span>
		try {
<span class="fc" id="L135">			conn = dataSource.getConnection();</span>
<span class="fc" id="L136">			final PreparedStatement insertStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.INSERT_IMPORTEDIFACE.getSqlStatement());</span>
<span class="fc" id="L137">			insertStatement.setObject(1, uuid);</span>
			// CHECKSTYLE:OFF
<span class="fc" id="L139">			insertStatement.setString(2, importedIface.getImportedClassName());</span>
<span class="fc" id="L140">			insertStatement.setObject(3, importedIface.getInterfaceID().getId());</span>
<span class="fc" id="L141">			insertStatement.setObject(4, importedIface.getContractID().getId());</span>
<span class="fc" id="L142">			insertStatement.setObject(5, importedIface.getClassOfImportID().getId());</span>
<span class="fc" id="L143">			insertStatement.setObject(6, importedIface.getNamespaceIDofClass().getId());</span>

<span class="fc" id="L145">			final UUID[] propertiesUsingImports = new UUID[importedIface.getPropertiesUsingImports().size()];</span>
<span class="fc" id="L146">			int i = 0;</span>
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">			for (final PropertyID propID : importedIface.getPropertiesUsingImports()) {</span>
<span class="nc" id="L148">				propertiesUsingImports[i] = propID.getId();</span>
<span class="nc" id="L149">				i++;</span>
<span class="nc" id="L150">			}</span>
<span class="fc" id="L151">			Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, propertiesUsingImports);</span>
<span class="fc" id="L152">			insertStatement.setArray(7, tArray);</span>

<span class="fc" id="L154">			final UUID[] operationsUsingImports = new UUID[importedIface.getOperationsUsingImports().size()];</span>
<span class="fc" id="L155">			i = 0;</span>
<span class="fc bfc" id="L156" title="All 2 branches covered.">			for (final OperationID opID : importedIface.getOperationsUsingImports()) {</span>
<span class="fc" id="L157">				operationsUsingImports[i] = opID.getId();</span>
<span class="fc" id="L158">				i++;</span>
<span class="fc" id="L159">			}</span>
<span class="fc" id="L160">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, operationsUsingImports);</span>
<span class="fc" id="L161">			insertStatement.setArray(8, tArray);</span>

<span class="fc" id="L163">			final UUID[] implementationsUsingImports = new UUID[importedIface.getImplementationsUsingImports().size()];</span>
<span class="fc" id="L164">			i = 0;</span>
<span class="fc bfc" id="L165" title="All 2 branches covered.">			for (final ImplementationID implID : importedIface.getImplementationsUsingImports()) {</span>
<span class="fc" id="L166">				implementationsUsingImports[i] = implID.getId();</span>
<span class="fc" id="L167">				i++;</span>
<span class="fc" id="L168">			}</span>
<span class="fc" id="L169">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, implementationsUsingImports);</span>
<span class="fc" id="L170">			insertStatement.setArray(9, tArray);</span>

<span class="fc" id="L172">			final UUID[] subClassesOfImport = new UUID[importedIface.getSubClassesOfImport().size()];</span>
<span class="fc" id="L173">			i = 0;</span>
<span class="fc bfc" id="L174" title="All 2 branches covered.">			for (final MetaClassID classID : importedIface.getSubClassesOfImport()) {</span>
<span class="fc" id="L175">				subClassesOfImport[i] = classID.getId();</span>
<span class="fc" id="L176">				i++;</span>
<span class="fc" id="L177">			}</span>
<span class="fc" id="L178">			tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, subClassesOfImport);</span>
<span class="fc" id="L179">			insertStatement.setArray(10, tArray);</span>

			// CHECKSTYLE:ON
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L183">				logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
			}
<span class="fc" id="L185">			insertStatement.executeUpdate();</span>
<span class="fc" id="L186">			insertStatement.close();</span>
<span class="nc" id="L187">		} catch (final Exception e) {</span>
<span class="nc" id="L188">			e.printStackTrace();</span>
		} finally {
			try {
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L192">					conn.close();</span>
				}
<span class="nc" id="L194">			} catch (final SQLException ex1) {</span>
<span class="nc" id="L195">				ex1.printStackTrace();</span>
<span class="fc" id="L196">			}</span>
		}
<span class="fc" id="L198">		return uuid;</span>

	}

	/**
	 * Store namespace into database
	 * @param namespace
	 *            namespace
	 */
	public void store(final Namespace namespace) {
<span class="fc" id="L208">		synchronized (dataSource) {</span>

<span class="fc" id="L210">			UUID[] importedIfaces = null;</span>
<span class="fc" id="L211">			UUID[] importedIfacesKeysFirst = null;</span>
<span class="fc" id="L212">			UUID[] importedIfacesKeysSecond = null;</span>
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">			if (namespace.getImportedInterfaces() != null) {</span>
<span class="fc" id="L214">				importedIfaces = new UUID[namespace.getImportedInterfaces().size()];</span>
<span class="fc" id="L215">				importedIfacesKeysFirst = new UUID[importedIfaces.length];</span>
<span class="fc" id="L216">				importedIfacesKeysSecond = new UUID[importedIfaces.length];</span>

<span class="fc" id="L218">				int i = 0;</span>
<span class="pc bpc" id="L219" title="1 of 2 branches missed.">				for (final Entry&lt;Tuple&lt;InterfaceID, ContractID&gt;, ImportedInterface&gt; curEntry : namespace.getImportedInterfaces().entrySet()) {</span>
<span class="nc" id="L220">					final InterfaceID ifaceID = curEntry.getKey().getFirst();</span>
<span class="nc" id="L221">					final ContractID contractID = curEntry.getKey().getSecond();</span>
<span class="nc" id="L222">					final ImportedInterface importedIface = curEntry.getValue();</span>
<span class="nc" id="L223">					final UUID importedIfaceUUID = this.store(importedIface);</span>
<span class="nc" id="L224">					importedIfaces[i] = importedIfaceUUID;</span>
<span class="nc" id="L225">					importedIfacesKeysFirst[i] = ifaceID.getId();</span>
<span class="nc" id="L226">					importedIfacesKeysSecond[i] = contractID.getId();</span>
<span class="nc" id="L227">					i++;</span>
<span class="nc" id="L228">				}</span>
			}

<span class="fc" id="L231">			Connection conn = null;</span>
			try {
<span class="fc" id="L233">				conn = dataSource.getConnection();</span>
<span class="fc" id="L234">				final PreparedStatement insertStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.INSERT_NAMESPACE.getSqlStatement());</span>
<span class="fc" id="L235">				insertStatement.setObject(1, namespace.getDataClayID().getId());</span>
				// CHECKSTYLE:OFF
<span class="fc" id="L237">				insertStatement.setString(2, namespace.getProviderAccountName());</span>
<span class="fc" id="L238">				insertStatement.setString(3, namespace.getName());</span>
<span class="fc" id="L239">				insertStatement.setObject(4, namespace.getProviderAccountID().getId());</span>

<span class="pc bpc" id="L241" title="1 of 2 branches missed.">				if (importedIfaces != null) {</span>
<span class="fc" id="L242">					Array tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, importedIfacesKeysFirst);</span>
<span class="fc" id="L243">					insertStatement.setArray(5, tArray);</span>
<span class="fc" id="L244">					tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, importedIfacesKeysSecond);</span>
<span class="fc" id="L245">					insertStatement.setArray(6, tArray);</span>
<span class="fc" id="L246">					tArray = insertStatement.getConnection().createArrayOf(&quot;uuid&quot;, importedIfaces);</span>
<span class="fc" id="L247">					insertStatement.setArray(7, tArray);</span>
<span class="fc" id="L248">				} else {</span>
<span class="nc" id="L249">					insertStatement.setArray(5, null);</span>
<span class="nc" id="L250">					insertStatement.setArray(6, null);</span>
<span class="nc" id="L251">					insertStatement.setArray(7, null);</span>

				}

<span class="fc" id="L255">				insertStatement.setString(8, namespace.getLanguage().name());</span>

				// CHECKSTYLE:ON
<span class="pc bpc" id="L258" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L259">					logger.debug(&quot;[==DB==] Executing &quot; + insertStatement);</span>
				}
<span class="fc" id="L261">				insertStatement.executeUpdate();</span>
<span class="fc" id="L262">				insertStatement.close();</span>
<span class="nc" id="L263">			} catch (final Exception e) {</span>
<span class="nc" id="L264">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L268">						conn.close();</span>
					}
<span class="nc" id="L270">				} catch (final SQLException ex1) {</span>
<span class="nc" id="L271">					ex1.printStackTrace();</span>
<span class="fc" id="L272">				}</span>
			}
<span class="fc" id="L274">		}</span>
<span class="fc" id="L275">	}</span>

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return ImportedInterface
	 */
	private ImportedInterface deserializeImportedInterface(
			final ResultSet rs) {
<span class="fc" id="L285">		ImportedInterface result = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L288">			final UUID uuid = (UUID)rs.getObject(&quot;id&quot;);</span>
<span class="fc" id="L289">			final String importedClassName = rs.getString(&quot;importedClassName&quot;);</span>
<span class="fc" id="L290">			final InterfaceID interfaceID = new InterfaceID((UUID)rs.getObject(&quot;interfaceID&quot;));</span>
<span class="fc" id="L291">			final ContractID contractID = new ContractID((UUID)rs.getObject(&quot;contractID&quot;));</span>
<span class="fc" id="L292">			final MetaClassID classOfImportID = new MetaClassID((UUID)rs.getObject(&quot;classOfImportID&quot;));</span>
<span class="fc" id="L293">			final NamespaceID namespaceIDofClass = new NamespaceID((UUID)rs.getObject(&quot;namespaceIDofClass&quot;));</span>
<span class="fc" id="L294">			final UUID[] propertiesUsingImportsUUIDs = (UUID[]) rs.getArray(&quot;propertiesUsingImports&quot;).getArray();</span>

<span class="fc" id="L296">			final HashSet&lt;PropertyID&gt; propertiesUsingImports = new HashSet&lt;&gt;();</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">			for (final UUID theuuid : propertiesUsingImportsUUIDs) {</span>
<span class="fc" id="L298">				propertiesUsingImports.add(new PropertyID(theuuid));</span>
			}

<span class="fc" id="L301">			final UUID[] operationsUsingImportsUUIDs = (UUID[]) rs.getArray(&quot;operationsUsingImports&quot;).getArray();</span>
<span class="fc" id="L302">			final HashSet&lt;OperationID&gt; operationsUsingImports = new HashSet&lt;&gt;();</span>
<span class="fc bfc" id="L303" title="All 2 branches covered.">			for (final UUID theuuid : operationsUsingImportsUUIDs) {</span>
<span class="fc" id="L304">				operationsUsingImports.add(new OperationID(theuuid));</span>
			}

<span class="fc" id="L307">			final UUID[] implementationsUsingImportsUUIDs = (UUID[]) rs.getArray(&quot;implementationsUsingImports&quot;).getArray();</span>
<span class="fc" id="L308">			final HashSet&lt;ImplementationID&gt; implementationsUsingImports = new HashSet&lt;&gt;();</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">			for (final UUID theuuid : implementationsUsingImportsUUIDs) {</span>
<span class="fc" id="L310">				implementationsUsingImports.add(new ImplementationID(theuuid));</span>
			}

<span class="fc" id="L313">			final UUID[] subClassesOfImportUUIDs = (UUID[]) rs.getArray(&quot;subClassesOfImport&quot;).getArray();</span>
<span class="fc" id="L314">			final HashSet&lt;MetaClassID&gt; subClassesOfImport = new HashSet&lt;&gt;();</span>
<span class="fc bfc" id="L315" title="All 2 branches covered.">			for (final UUID theuuid : subClassesOfImportUUIDs) {</span>
<span class="fc" id="L316">				subClassesOfImport.add(new MetaClassID(theuuid));</span>
			}

<span class="fc" id="L319">			result = new ImportedInterface();</span>
<span class="fc" id="L320">			result.setClassOfImportID(classOfImportID);</span>
<span class="fc" id="L321">			result.setContractID(contractID);</span>
<span class="fc" id="L322">			result.setNamespaceIDofClass(namespaceIDofClass);</span>
<span class="fc" id="L323">			result.setId(uuid);</span>
<span class="fc" id="L324">			result.setImplementationsUsingImports(implementationsUsingImports);</span>
<span class="fc" id="L325">			result.setImportedClassName(importedClassName);</span>
<span class="fc" id="L326">			result.setInterfaceID(interfaceID);</span>
<span class="fc" id="L327">			result.setOperationsUsingImports(operationsUsingImports);</span>
<span class="fc" id="L328">			result.setPropertiesUsingImports(propertiesUsingImports);</span>
<span class="fc" id="L329">			result.setSubClassesOfImport(subClassesOfImport);</span>

<span class="nc" id="L331">		} catch (final SQLException e) {</span>
<span class="nc" id="L332">			e.printStackTrace();</span>
<span class="fc" id="L333">		}</span>
<span class="fc" id="L334">		return result;</span>
	}

	/**
	 * Deserialize
	 * @param rs
	 *            Result set
	 * @return Namespace
	 */
	private Namespace deserializeNamespace(
			final ResultSet rs) {
<span class="fc" id="L345">		Namespace result = null;</span>
		try {
			// CHECKSTYLE:OFF
<span class="fc" id="L348">			final NamespaceID namespaceID = new NamespaceID((UUID)rs.getObject(&quot;id&quot;));</span>
<span class="fc" id="L349">			final String providerAccountName = rs.getString(&quot;providerAccountName&quot;);</span>
<span class="fc" id="L350">			final String name = rs.getString(&quot;name&quot;);</span>
<span class="fc" id="L351">			final AccountID responsibleAccountID = new AccountID((UUID)rs.getObject(&quot;responsible&quot;));</span>

<span class="fc" id="L353">			final Map&lt;Tuple&lt;InterfaceID, ContractID&gt;, ImportedInterface&gt; importedInterfaces = new HashMap&lt;&gt;();</span>

<span class="fc" id="L355">			final Array arr = rs.getArray(&quot;importedInterfacesFirstKey&quot;);</span>
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">			if (arr != null) {</span>
<span class="fc" id="L357">				final UUID[] importedInterfacesFirstKey = (UUID[]) arr.getArray();</span>
<span class="fc" id="L358">				final UUID[] importedInterfacesSecondKey = (UUID[]) rs.getArray(&quot;importedInterfacesSecondKey&quot;).getArray();</span>
<span class="fc" id="L359">				final UUID[] importedInterfacesValues = (UUID[]) rs.getArray(&quot;importedInterfacesValues&quot;).getArray();</span>
<span class="fc bfc" id="L360" title="All 2 branches covered.">				for (int i = 0; i &lt; importedInterfacesFirstKey.length; ++i) {</span>
<span class="fc" id="L361">					final InterfaceID ifaceID = new InterfaceID(importedInterfacesFirstKey[i]);</span>
<span class="fc" id="L362">					final ContractID contractID = new ContractID(importedInterfacesSecondKey[i]);</span>
<span class="fc" id="L363">					final ImportedInterface importedInterface = this.getImportedInterfaceByID(importedInterfacesValues[i]);</span>
<span class="fc" id="L364">					importedInterfaces.put(new Tuple&lt;&gt;(ifaceID, contractID), importedInterface);</span>

				}
			}

<span class="fc" id="L369">			final Langs language = Langs.valueOf(rs.getString(&quot;language&quot;));</span>

<span class="fc" id="L371">			result = new Namespace(name, providerAccountName, language);</span>
<span class="fc" id="L372">			result.setDataClayID(namespaceID);</span>
<span class="fc" id="L373">			result.setImportedInterfaces(importedInterfaces);</span>
<span class="fc" id="L374">			result.setProviderAccountID(responsibleAccountID);</span>

<span class="nc" id="L376">		} catch (final SQLException e) {</span>
<span class="nc" id="L377">			e.printStackTrace();</span>
<span class="fc" id="L378">		}</span>
<span class="fc" id="L379">		return result;</span>
	}

	/**
	 * Get by ID
	 * @param uuid
	 *            ID of object
	 * @return The object
	 * @throws SQLException
	 *             if not found
	 */
	private ImportedInterface getImportedInterfaceByID(final UUID uuid) throws SQLException {
<span class="fc" id="L391">		ResultSet rs = null;</span>
<span class="fc" id="L392">		ImportedInterface result = null;</span>
<span class="fc" id="L393">		Connection conn = null;</span>
		try {
<span class="fc" id="L395">			conn = dataSource.getConnection();</span>
<span class="fc" id="L396">			final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_IMPORTEDIFACE.getSqlStatement());</span>

<span class="fc" id="L398">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L400">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L402">			rs = selectStatement.executeQuery();</span>
<span class="pc bpc" id="L403" title="1 of 2 branches missed.">			if (rs.next()) {</span>
<span class="fc" id="L404">				result = deserializeImportedInterface(rs);</span>
			}
<span class="fc" id="L406">			selectStatement.close();</span>
<span class="nc" id="L407">		} catch (final SQLException e) {</span>
<span class="nc" id="L408">			throw e;</span>
		} finally {
			try {
<span class="pc bpc" id="L411" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L412">					conn.close();</span>
				}
<span class="nc" id="L414">			} catch (final SQLException e) {</span>
<span class="nc" id="L415">				e.printStackTrace();</span>
<span class="fc" id="L416">			}</span>
		}

<span class="fc" id="L419">		return result;</span>
	}

	/**
	 * Get by ID
	 * @param namespaceID
	 *            ID of object
	 * @return The object
	 * @throws SQLException
	 *             if not found
	 */
	public Namespace getNamespaceByID(final NamespaceID namespaceID) {
<span class="fc" id="L431">		synchronized (dataSource) {</span>

<span class="fc" id="L433">			ResultSet rs = null;</span>
<span class="fc" id="L434">			Namespace result = null;</span>
<span class="fc" id="L435">			Connection conn = null;</span>
			try {
<span class="fc" id="L437">				conn = dataSource.getConnection();</span>
<span class="fc" id="L438">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_NAMESPACE.getSqlStatement());</span>

<span class="fc" id="L440">				selectStatement.setObject(1, namespaceID.getId());</span>
<span class="pc bpc" id="L441" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L442">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="fc" id="L444">				rs = selectStatement.executeQuery();</span>
<span class="fc bfc" id="L445" title="All 2 branches covered.">				if (rs.next()) {</span>
<span class="fc" id="L446">					result = deserializeNamespace(rs);</span>

				}
<span class="fc" id="L449">				selectStatement.close();</span>
<span class="nc" id="L450">			} catch (final SQLException e) {</span>
				// ignore

			} finally {
				try {
<span class="pc bpc" id="L455" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L456">						conn.close();</span>
					}
<span class="nc" id="L458">				} catch (final SQLException e) {</span>
<span class="nc" id="L459">					e.printStackTrace();</span>
<span class="fc" id="L460">				}</span>
			}

<span class="fc" id="L463">			return result;</span>
		}
	}

	/**
	 * Delete by ID
	 * @param uuid
	 *            ID of object
	 */
	private void deleteImportedInterfaceByID(final UUID uuid) {

<span class="fc" id="L474">		Connection conn = null;</span>
		try {
<span class="fc" id="L476">			conn = dataSource.getConnection();</span>
<span class="fc" id="L477">			final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.DELETE_IMPORTEDIFACE.getSqlStatement());</span>
<span class="fc" id="L478">			selectStatement.setObject(1, uuid);</span>
<span class="pc bpc" id="L479" title="1 of 2 branches missed.">			if (DEBUG_ENABLED) {</span>
<span class="nc" id="L480">				logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
			}
<span class="fc" id="L482">			selectStatement.executeUpdate();</span>
<span class="fc" id="L483">			selectStatement.close();</span>

<span class="nc" id="L485">		} catch (final SQLException e) {</span>
			// not found, ignore
			// e.printStackTrace();
		} finally {
			try {
<span class="pc bpc" id="L490" title="1 of 2 branches missed.">				if (conn != null) {</span>
<span class="fc" id="L491">					conn.close();</span>
				}
<span class="nc" id="L493">			} catch (final SQLException e) {</span>
<span class="nc" id="L494">				e.printStackTrace();</span>
<span class="fc" id="L495">			}</span>
		}

<span class="fc" id="L498">	}</span>

	/**
	 * Delete by ID
	 * @param namespaceID
	 *            ID of object
	 */
	public void deleteNamespaceByID(final NamespaceID namespaceID) {
<span class="fc" id="L506">		synchronized (dataSource) {</span>

<span class="fc" id="L508">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="pc bpc" id="L509" title="1 of 2 branches missed.">			for (final ImportedInterface importedIface : namespace.getImportedInterfaces().values()) {</span>
<span class="nc" id="L510">				this.deleteImportedInterfaceByID(importedIface.getId());</span>
<span class="nc" id="L511">			}</span>

<span class="fc" id="L513">			Connection conn = null;</span>
			try {
<span class="fc" id="L515">				conn = dataSource.getConnection();</span>
<span class="fc" id="L516">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.DELETE_NAMESPACE.getSqlStatement());</span>
<span class="fc" id="L517">				selectStatement.setObject(1, namespaceID.getId());</span>
<span class="pc bpc" id="L518" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L519">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="fc" id="L521">				selectStatement.executeUpdate();</span>
<span class="fc" id="L522">				selectStatement.close();</span>

<span class="nc" id="L524">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L529" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L530">						conn.close();</span>
					}
<span class="nc" id="L532">				} catch (final SQLException e) {</span>
<span class="nc" id="L533">					e.printStackTrace();</span>
<span class="fc" id="L534">				}</span>
			}
<span class="fc" id="L536">		}</span>

<span class="fc" id="L538">	}</span>

	/**
	 * Get by name
	 * @return The object
	 * @throws SQLException
	 *             if not found
	 */
	public Set&lt;String&gt; getNamespacesNames() {
<span class="fc" id="L547">		synchronized (dataSource) {</span>

<span class="fc" id="L549">			ResultSet rs = null;</span>
<span class="fc" id="L550">			final Set&lt;String&gt; result = new HashSet&lt;&gt;();</span>
<span class="fc" id="L551">			Connection conn = null;</span>
			try {
<span class="fc" id="L553">				conn = dataSource.getConnection();</span>
<span class="fc" id="L554">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_NAMESPACES_NAMES.getSqlStatement());</span>

<span class="pc bpc" id="L556" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L557">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="fc" id="L559">				rs = selectStatement.executeQuery();</span>
<span class="fc bfc" id="L560" title="All 2 branches covered.">				while (rs.next()) {</span>
<span class="fc" id="L561">					result.add(rs.getString(1));</span>
				}
<span class="fc" id="L563">				selectStatement.close();</span>

<span class="nc" id="L565">			} catch (final SQLException e) {</span>
				// ignore
			} finally {
				try {
<span class="pc bpc" id="L569" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L570">						conn.close();</span>
					}
<span class="nc" id="L572">				} catch (final SQLException e) {</span>
<span class="nc" id="L573">					e.printStackTrace();</span>
<span class="fc" id="L574">				}</span>
			}

<span class="fc" id="L577">			return result;</span>
		}
	}

	/**
	 * Get by name
	 * @param name
	 *            the name
	 * @return The object
	 * @throws SQLException
	 *             if not found
	 */
	public Namespace getNamespaceByName(final String name) {
<span class="fc" id="L590">		synchronized (dataSource) {</span>

<span class="fc" id="L592">			ResultSet rs = null;</span>
<span class="fc" id="L593">			Namespace result = null;</span>
<span class="fc" id="L594">			Connection conn = null;</span>
			try {
<span class="fc" id="L596">				conn = dataSource.getConnection();</span>
<span class="fc" id="L597">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_NAMESPACE_BY_NAME.getSqlStatement());</span>

<span class="fc" id="L599">				selectStatement.setString(1, name);</span>
<span class="pc bpc" id="L600" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L601">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="fc" id="L603">				rs = selectStatement.executeQuery();</span>
<span class="fc bfc" id="L604" title="All 2 branches covered.">				if (rs.next()) {</span>
<span class="fc" id="L605">					result = deserializeNamespace(rs);</span>

				}
<span class="fc" id="L608">				selectStatement.close();</span>

<span class="nc" id="L610">			} catch (final SQLException e) {</span>
				// ignore
			} finally {
				try {
<span class="pc bpc" id="L614" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L615">						conn.close();</span>
					}
<span class="nc" id="L617">				} catch (final SQLException e) {</span>
<span class="nc" id="L618">					e.printStackTrace();</span>
<span class="fc" id="L619">				}</span>
			}

<span class="fc" id="L622">			return result;</span>
		}
	}

	/**
	 * Get by name and id
	 * @param name
	 *            the name
	 * @param namespaceID
	 *            ID of the namespace
	 * @return The object
	 * @throws SQLException
	 *             if not found
	 */
	public Namespace getNamespaceByNameAndID(final String name, final NamespaceID namespaceID) {
<span class="nc" id="L637">		synchronized (dataSource) {</span>

<span class="nc" id="L639">			ResultSet rs = null;</span>
<span class="nc" id="L640">			Namespace result = null;</span>
<span class="nc" id="L641">			Connection conn = null;</span>
			try {
<span class="nc" id="L643">				conn = dataSource.getConnection();</span>
<span class="nc" id="L644">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_ALL_NAMESPACES_OF_ACCOUNT_AND_ID.getSqlStatement());</span>

<span class="nc" id="L646">				selectStatement.setString(1, name);</span>
<span class="nc" id="L647">				selectStatement.setObject(2, namespaceID.getId());</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L649">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="nc" id="L651">				rs = selectStatement.executeQuery();</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L653">					result = deserializeNamespace(rs);</span>

				}
<span class="nc" id="L656">				selectStatement.close();</span>

<span class="nc" id="L658">			} catch (final SQLException e) {</span>
				// ignore
			} finally {
				try {
<span class="nc bnc" id="L662" title="All 2 branches missed.">					if (conn != null) {</span>
<span class="nc" id="L663">						conn.close();</span>
					}
<span class="nc" id="L665">				} catch (final SQLException e) {</span>
<span class="nc" id="L666">					e.printStackTrace();</span>
<span class="nc" id="L667">				}</span>
			}

<span class="nc" id="L670">			return result;</span>
		}
	}

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param importedIface
	 *            Iface added
	 */
	public void updateNamespaceAddImport(final NamespaceID namespaceID, final ImportedInterface importedIface) {
<span class="fc" id="L682">		synchronized (dataSource) {</span>

<span class="fc" id="L684">			final UUID importedIfaceUUID = this.store(importedIface);</span>
<span class="fc" id="L685">			Connection conn = null;</span>
			try {
<span class="fc" id="L687">				conn = dataSource.getConnection();</span>
<span class="fc" id="L688">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_NAMESPACE_ADD_IMPORTEDIFACE.getSqlStatement());</span>

<span class="fc" id="L690">				stmt.setObject(1, importedIface.getInterfaceID().getId());</span>
<span class="fc" id="L691">				stmt.setObject(2, importedIface.getContractID().getId());</span>
<span class="fc" id="L692">				stmt.setObject(3, importedIfaceUUID);</span>
<span class="fc" id="L693">				stmt.setObject(4, namespaceID.getId());</span>
<span class="pc bpc" id="L694" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L695">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L697">				stmt.executeUpdate();</span>
<span class="fc" id="L698">				stmt.close();</span>

<span class="nc" id="L700">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L705" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L706">						conn.close();</span>
					}
<span class="nc" id="L708">				} catch (final SQLException e) {</span>
<span class="nc" id="L709">					e.printStackTrace();</span>
<span class="fc" id="L710">				}</span>
			}
<span class="fc" id="L712">		}</span>
<span class="fc" id="L713">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 */
	public void updateNamespaceRemoveImport(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID) {
<span class="fc" id="L725">		synchronized (dataSource) {</span>

<span class="fc" id="L727">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L728">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L729">			this.deleteImportedInterfaceByID(importedIface.getId());</span>

<span class="fc" id="L731">			Connection conn = null;</span>
			try {
<span class="fc" id="L733">				conn = dataSource.getConnection();</span>
<span class="fc" id="L734">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_NAMESPACE_REMOVE_IMPORTEDIFACE.getSqlStatement());</span>

<span class="fc" id="L736">				stmt.setObject(1, ifaceID.getId());</span>
<span class="fc" id="L737">				stmt.setObject(2, contractID.getId());</span>
<span class="fc" id="L738">				stmt.setObject(3, importedIface.getId());</span>
<span class="fc" id="L739">				stmt.setObject(4, namespaceID.getId());</span>
<span class="pc bpc" id="L740" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L741">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L743">				stmt.executeUpdate();</span>
<span class="fc" id="L744">				stmt.close();</span>

<span class="nc" id="L746">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L751" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L752">						conn.close();</span>
					}
<span class="nc" id="L754">				} catch (final SQLException e) {</span>
<span class="nc" id="L755">					e.printStackTrace();</span>
<span class="fc" id="L756">				}</span>
			}
<span class="fc" id="L758">		}</span>

<span class="fc" id="L760">	}</span>

	/**
	 * Get Namespaces containing provider
	 * @param providerAccountID
	 *            Account ID
	 * @return The Namespace
	 */
	public List&lt;Namespace&gt; getNamespacesWithProvider(final AccountID providerAccountID) {
<span class="fc" id="L769">		synchronized (dataSource) {</span>

<span class="fc" id="L771">			ResultSet rs = null;</span>
<span class="fc" id="L772">			final List&lt;Namespace&gt; result = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L773">			Connection conn = null;</span>
			try {
<span class="fc" id="L775">				conn = dataSource.getConnection();</span>
<span class="fc" id="L776">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_ALL_NAMESPACES_OF_ACCOUNT.getSqlStatement());</span>
<span class="fc" id="L777">				selectStatement.setObject(1, providerAccountID.getId());</span>
<span class="pc bpc" id="L778" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L779">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="fc" id="L781">				rs = selectStatement.executeQuery();</span>
<span class="fc bfc" id="L782" title="All 2 branches covered.">				while (rs.next()) {</span>
<span class="fc" id="L783">					result.add(deserializeNamespace(rs));</span>
				}
<span class="fc" id="L785">				selectStatement.close();</span>

<span class="nc" id="L787">			} catch (final SQLException e) {</span>
<span class="nc" id="L788">				e.printStackTrace();</span>
			} finally {
				try {
<span class="pc bpc" id="L791" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L792">						conn.close();</span>
					}
<span class="nc" id="L794">				} catch (final SQLException e) {</span>
<span class="nc" id="L795">					e.printStackTrace();</span>
<span class="fc" id="L796">				}</span>
			}

<span class="fc" id="L799">			return result;</span>
		}
	}

	/**
	 * Get Namespaces using class
	 * @param classID
	 *            class id
	 * @return The Namespace
	 */
	public List&lt;Namespace&gt; getAllNamespacesImportingClass(final MetaClassID classID) {
<span class="nc" id="L810">		synchronized (dataSource) {</span>

<span class="nc" id="L812">			ResultSet rs = null;</span>
<span class="nc" id="L813">			final List&lt;Namespace&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L814">			Connection conn = null;</span>
			try {
<span class="nc" id="L816">				conn = dataSource.getConnection();</span>
<span class="nc" id="L817">				final PreparedStatement selectStatement = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.SELECT_ALL_NAMESPACES_IMPORT_IFACE.getSqlStatement());</span>
<span class="nc" id="L818">				selectStatement.setObject(1, classID.getId());</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L820">					logger.debug(&quot;[==DB==] Executing &quot; + selectStatement);</span>
				}
<span class="nc" id="L822">				rs = selectStatement.executeQuery();</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L824">					result.add(deserializeNamespace(rs));</span>
				}
<span class="nc" id="L826">				selectStatement.close();</span>

<span class="nc" id="L828">			} catch (final SQLException e) {</span>
<span class="nc" id="L829">				e.printStackTrace();</span>
			} finally {
				try {
<span class="nc bnc" id="L832" title="All 2 branches missed.">					if (conn != null) {</span>
<span class="nc" id="L833">						conn.close();</span>
					}
<span class="nc" id="L835">				} catch (final SQLException e) {</span>
<span class="nc" id="L836">					e.printStackTrace();</span>
<span class="nc" id="L837">				}</span>
			}

<span class="nc" id="L840">			return result;</span>
		}
	}

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param propertyID
	 *            Property ID
	 */
	public void updateImportedInterfaceAddProperty(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final PropertyID propertyID) {
<span class="fc" id="L857">		synchronized (dataSource) {</span>

<span class="fc" id="L859">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L860">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L861">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L863">			Connection conn = null;</span>
			try {
<span class="fc" id="L865">				conn = dataSource.getConnection();</span>
<span class="fc" id="L866">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_ADD_PROPERTY.getSqlStatement());</span>
<span class="fc" id="L867">				stmt.setObject(1, propertyID.getId());</span>
<span class="fc" id="L868">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L869" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L870">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L872">				stmt.executeUpdate();</span>
<span class="fc" id="L873">				stmt.close();</span>

<span class="nc" id="L875">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L880" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L881">						conn.close();</span>
					}
<span class="nc" id="L883">				} catch (final SQLException e) {</span>
<span class="nc" id="L884">					e.printStackTrace();</span>
<span class="fc" id="L885">				}</span>
			}
<span class="fc" id="L887">		}</span>

<span class="fc" id="L889">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param operationID
	 *            Operation ID
	 */
	public void updateImportedInterfaceAddOperation(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final OperationID operationID) {
<span class="fc" id="L904">		synchronized (dataSource) {</span>

<span class="fc" id="L906">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L907">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L908">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L910">			Connection conn = null;</span>
			try {
<span class="fc" id="L912">				conn = dataSource.getConnection();</span>
<span class="fc" id="L913">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_ADD_OPERATION.getSqlStatement());</span>
<span class="fc" id="L914">				stmt.setObject(1, operationID.getId());</span>
<span class="fc" id="L915">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L916" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L917">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L919">				stmt.executeUpdate();</span>
<span class="fc" id="L920">				stmt.close();</span>

<span class="nc" id="L922">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L927" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L928">						conn.close();</span>
					}
<span class="nc" id="L930">				} catch (final SQLException e) {</span>
<span class="nc" id="L931">					e.printStackTrace();</span>
<span class="fc" id="L932">				}</span>
			}
<span class="fc" id="L934">		}</span>
<span class="fc" id="L935">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param implementationID
	 *            Implementation ID
	 */
	public void updateImportedInterfaceAddImplementation(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final ImplementationID implementationID) {
<span class="fc" id="L950">		synchronized (dataSource) {</span>

<span class="fc" id="L952">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L953">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L954">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L956">			Connection conn = null;</span>
			try {
<span class="fc" id="L958">				conn = dataSource.getConnection();</span>
<span class="fc" id="L959">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_ADD_IMPLEMENTATION.getSqlStatement());</span>
<span class="fc" id="L960">				stmt.setObject(1, implementationID.getId());</span>
<span class="fc" id="L961">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L962" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L963">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L965">				stmt.executeUpdate();</span>
<span class="fc" id="L966">				stmt.close();</span>

<span class="nc" id="L968">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L973" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L974">						conn.close();</span>
					}
<span class="nc" id="L976">				} catch (final SQLException e) {</span>
<span class="nc" id="L977">					e.printStackTrace();</span>
<span class="fc" id="L978">				}</span>
			}
<span class="fc" id="L980">		}</span>

<span class="fc" id="L982">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param subClassID
	 *            MetaClass ID
	 */
	public void updateImportedInterfaceAddSubClass(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final MetaClassID subClassID) {
<span class="fc" id="L997">		synchronized (dataSource) {</span>

<span class="fc" id="L999">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L1000">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L1001">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L1003">			Connection conn = null;</span>
			try {
<span class="fc" id="L1005">				conn = dataSource.getConnection();</span>
<span class="fc" id="L1006">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_ADD_SUBCLASS.getSqlStatement());</span>
<span class="fc" id="L1007">				stmt.setObject(1, subClassID.getId());</span>
<span class="fc" id="L1008">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L1009" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1010">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L1012">				stmt.executeUpdate();</span>
<span class="fc" id="L1013">				stmt.close();</span>

<span class="nc" id="L1015">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L1020" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L1021">						conn.close();</span>
					}
<span class="nc" id="L1023">				} catch (final SQLException e) {</span>
<span class="nc" id="L1024">					e.printStackTrace();</span>
<span class="fc" id="L1025">				}</span>
			}
<span class="fc" id="L1027">		}</span>
<span class="fc" id="L1028">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param propertyID
	 *            Property ID
	 */
	public void updateImportedInterfaceRemoveProperty(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final PropertyID propertyID) {
<span class="nc" id="L1043">		synchronized (dataSource) {</span>

<span class="nc" id="L1045">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="nc" id="L1046">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="nc" id="L1047">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="nc" id="L1049">			Connection conn = null;</span>
			try {
<span class="nc" id="L1051">				conn = dataSource.getConnection();</span>
<span class="nc" id="L1052">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_REMOVE_PROPERTY.getSqlStatement());</span>
<span class="nc" id="L1053">				stmt.setObject(1, propertyID.getId());</span>
<span class="nc" id="L1054">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1056">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="nc" id="L1058">				stmt.executeUpdate();</span>
<span class="nc" id="L1059">				stmt.close();</span>

<span class="nc" id="L1061">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="nc bnc" id="L1066" title="All 2 branches missed.">					if (conn != null) {</span>
<span class="nc" id="L1067">						conn.close();</span>
					}
<span class="nc" id="L1069">				} catch (final SQLException e) {</span>
<span class="nc" id="L1070">					e.printStackTrace();</span>
<span class="nc" id="L1071">				}</span>
			}
<span class="nc" id="L1073">		}</span>

<span class="nc" id="L1075">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param operationID
	 *            Operation ID
	 */
	public void updateImportedInterfaceRemoveOperation(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final OperationID operationID) {
<span class="fc" id="L1090">		synchronized (dataSource) {</span>

<span class="fc" id="L1092">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L1093">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L1094">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L1096">			Connection conn = null;</span>
			try {
<span class="fc" id="L1098">				conn = dataSource.getConnection();</span>
<span class="fc" id="L1099">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_REMOVE_OPERATION.getSqlStatement());</span>
<span class="fc" id="L1100">				stmt.setObject(1, operationID.getId());</span>
<span class="fc" id="L1101">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L1102" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1103">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L1105">				stmt.executeUpdate();</span>
<span class="fc" id="L1106">				stmt.close();</span>

<span class="nc" id="L1108">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L1113" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L1114">						conn.close();</span>
					}
<span class="nc" id="L1116">				} catch (final SQLException e) {</span>
<span class="nc" id="L1117">					e.printStackTrace();</span>
<span class="fc" id="L1118">				}</span>
			}
<span class="fc" id="L1120">		}</span>
<span class="fc" id="L1121">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param implementationID
	 *            Implementation ID
	 */
	public void updateImportedInterfaceRemoveImplementation(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final ImplementationID implementationID) {
<span class="fc" id="L1136">		synchronized (dataSource) {</span>

<span class="fc" id="L1138">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L1139">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L1140">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L1142">			Connection conn = null;</span>
			try {
<span class="fc" id="L1144">				conn = dataSource.getConnection();</span>
<span class="fc" id="L1145">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_REMOVE_IMPLEMENTATION.getSqlStatement());</span>
<span class="fc" id="L1146">				stmt.setObject(1, implementationID.getId());</span>
<span class="fc" id="L1147">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L1148" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1149">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L1151">				stmt.executeUpdate();</span>
<span class="fc" id="L1152">				stmt.close();</span>

<span class="nc" id="L1154">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L1159" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L1160">						conn.close();</span>
					}
<span class="nc" id="L1162">				} catch (final SQLException e) {</span>
<span class="nc" id="L1163">					e.printStackTrace();</span>
<span class="fc" id="L1164">				}</span>
			}
<span class="fc" id="L1166">		}</span>

<span class="fc" id="L1168">	}</span>

	/**
	 * Update by ID
	 * @param namespaceID
	 *            ID of object
	 * @param ifaceID
	 *            Iface ID
	 * @param contractID
	 *            Contract ID
	 * @param subClassID
	 *            MetaClass ID
	 */
	public void updateImportedInterfaceRemoveSubClass(final NamespaceID namespaceID, final InterfaceID ifaceID, final ContractID contractID,
			final MetaClassID subClassID) {
<span class="fc" id="L1183">		synchronized (dataSource) {</span>

<span class="fc" id="L1185">			final Namespace namespace = this.getNamespaceByID(namespaceID);</span>
<span class="fc" id="L1186">			final ImportedInterface importedIface = namespace.getImportedInterface(ifaceID, contractID);</span>
<span class="fc" id="L1187">			final UUID importedIfaceUUID = importedIface.getId();</span>

<span class="fc" id="L1189">			Connection conn = null;</span>
			try {
<span class="fc" id="L1191">				conn = dataSource.getConnection();</span>
<span class="fc" id="L1192">				final PreparedStatement stmt = conn.prepareStatement(NamespaceManagerSQLStatements.SqlStatements.UPDATE_IMPORTEDIFACE_REMOVE_SUBCLASS.getSqlStatement());</span>
<span class="fc" id="L1193">				stmt.setObject(1, subClassID.getId());</span>
<span class="fc" id="L1194">				stmt.setObject(2, importedIfaceUUID);</span>
<span class="pc bpc" id="L1195" title="1 of 2 branches missed.">				if (DEBUG_ENABLED) {</span>
<span class="nc" id="L1196">					logger.debug(&quot;[==DB==] Executing &quot; + stmt);</span>
				}
<span class="fc" id="L1198">				stmt.executeUpdate();</span>
<span class="fc" id="L1199">				stmt.close();</span>

<span class="nc" id="L1201">			} catch (final SQLException e) {</span>
				// not found, ignore
				// e.printStackTrace();
			} finally {
				try {
<span class="pc bpc" id="L1206" title="1 of 2 branches missed.">					if (conn != null) {</span>
<span class="fc" id="L1207">						conn.close();</span>
					}
<span class="nc" id="L1209">				} catch (final SQLException e) {</span>
<span class="nc" id="L1210">					e.printStackTrace();</span>
<span class="fc" id="L1211">				}</span>
			}
<span class="fc" id="L1213">		}</span>
<span class="fc" id="L1214">	}</span>

	/**
	 * Close DB.
	 */
	public void close() {
		try {
<span class="fc" id="L1221">			dataSource.close();</span>
<span class="nc" id="L1222">		}catch(Exception e) {</span>
			// TODO
<span class="nc" id="L1224">			e.printStackTrace();</span>
<span class="fc" id="L1225">		}</span>
<span class="fc" id="L1226">	}</span>

	/**
	 * Check if namespace exists
	 * @param dataClayID
	 *            ID of namespace
	 * @return TRUE if exists.
	 */
	public boolean existsObjectByID(final NamespaceID dataClayID) {
<span class="fc bfc" id="L1235" title="All 2 branches covered.">		return this.getNamespaceByID(dataClayID) != null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>